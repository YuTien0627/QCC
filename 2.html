<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QCC çŸ¥è­˜æŒ‘æˆ°</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@500;700;900&display=swap" rel="stylesheet">
<style>
body { font-family:'Noto Sans TC',sans-serif; background-color:#ecfdf5; }
.quiz-card { background-color:#ffffff; border-radius:1.5rem; box-shadow:0 20px 35px -18px rgba(15,23,42,0.45); }
.quiz-type-btn { color:white; padding:2rem 1.5rem; border-radius:1rem; font-weight:700; font-size:1.5rem; transition: transform 0.2s, box-shadow 0.2s; border:2px solid white; flex-grow:1; }
.quiz-type-btn:hover { transform: translateY(-3px) scale(1.02); box-shadow:0 10px 25px rgba(0,0,0,0.2); }
.answer-option { transition: all 0.3s; cursor:pointer; border-width:2px; background:white; padding:1.5rem; border-radius:1rem; box-shadow:0 5px 15px rgba(0,0,0,0.1); margin-bottom:0.75rem; }
.answer-option:hover:not(.disabled) { transform: translateY(-2px); box-shadow:0 8px 18px rgba(0,0,0,0.15); }
.correct-blink { animation: correctBlink 0.5s ease-in-out 3; pointer-events:none; }
@keyframes correctBlink { 0%,100% {background-color:#6ee7b7;border-color:#059669; transform: scale(1.05);} 50% {background-color:#d1fae5;border-color:#10b981; transform: scale(1);} }
.incorrect-shake { animation: incorrectShake 0.4s ease-in-out; pointer-events:none; filter:grayscale(80%);}
@keyframes incorrectShake { 0%,100%{transform:translateX(0);background-color:#fca5a5;border-color:#dc2626;} 20%,60%{transform:translateX(-6px);} 40%,80%{transform:translateX(6px);} }
.fun-action-btn { background-image: linear-gradient(to right,#06b6d4,#0d9488); color:white; transition: all 0.2s; padding:1.5rem; border-radius:1rem; font-size:1.5rem; font-weight:700; }
.fun-action-btn:hover:not(:disabled) { transform: scale(1.02); box-shadow:0 8px 20px rgba(0,0,0,0.3); }
.fun-action-btn:disabled { background:#9ca3af; cursor:not-allowed; }
#quizFeedback { font-size:1.5rem; line-height:1.4; }
</style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

<div id="app" class="w-full max-w-4xl p-6 quiz-card">
    <h1 id="mainTitle" class="text-4xl font-extrabold text-teal-700 text-center mb-6">ğŸ› ï¸ QCC çŸ¥è­˜é»é»å ğŸ¯</h1>
    
    <div id="welcomeScreen" class="p-8 rounded-xl shadow-md text-center">
        <h2 class="text-3xl font-bold mb-6">ğŸ† è«‹é¸æ“‡æŒ‘æˆ°é¡å‹ ğŸ†</h2>
        <div id="typeSelector" class="flex flex-col md:flex-row gap-4 mb-8">
            <button id="selectProblemType" data-type="problem" class="quiz-type-btn bg-teal-500 hover:bg-teal-600">å•é¡Œè§£æ±ºå‹</button>
            <button id="selectSolutionType" data-type="solution" class="quiz-type-btn bg-indigo-500 hover:bg-indigo-600">èª²é¡Œé”æˆå‹</button>
        </div>
    </div>

    <div id="progressSection" class="mb-4 hidden">
        <div id="progressDisplay" class="text-lg font-bold text-teal-700 mb-2 text-center">æº–å‚™é–‹å§‹...</div>
        <div class="w-full bg-gray-200 rounded-full h-3">
            <div id="progressBar" class="bg-gradient-to-r from-teal-400 to-indigo-500 h-3 rounded-full transition-all duration-500" style="width:0%"></div>
        </div>
    </div>

    <div id="quizContainer" class="hidden p-6 rounded-xl shadow-md border-2 border-teal-300">
        <p id="quizQuestion" class="text-2xl font-extrabold text-gray-800 text-center mb-6">é¡Œç›®å…§å®¹</p>
        <div id="quizOptions"></div>
        <div id="quizFeedback" class="hidden mt-4 p-4 text-center rounded-xl font-bold border-2"></div>
        <button id="mainActionBtn" class="fun-action-btn w-full mt-6">é€²è¡Œä¸‹ä¸€é¡Œ</button>
    </div>

    <div id="resultContainer" class="hidden mt-6 p-6 rounded-xl shadow-md border-2 border-teal-400"></div>
</div>

<script type="module">
import { PROBLEM_STEPS_DATA, SOLUTION_STEPS_DATA } from './quizData.js';

// ---- äº’å‹•ç¨‹å¼ç¢¼ä¿æŒä¸è®Š ----
// ä½ çš„ initializeQuiz(), startQuiz(), displayQuestion(), selectAnswer(), updateProgressDisplay(), showResults()
// ä»¥åŠå…¨åŸŸç‹€æ…‹è®Šæ•¸ (currentQuestions, currentQuestionIndex, userScore, stepPerformance, domRefs)
// éƒ½å¯ä»¥ç›´æ¥è¤‡è£½åŸå§‹ç¢¼æ”¾é€™è£¡

// å…¨åŸŸç‹€æ…‹è®Šæ•¸
  let currentQuestions = []; // å„²å­˜ç•¶å‰æ¨¡å¼çš„ 9 é¡Œ
  let currentQuestionIndex = -1;
  let userScore = 0;
  let quizInProgress = false;
  let stepPerformance = {}; // è¿½è¹¤æ¯å€‹ QCC æ­¥é©Ÿçš„è¡¨ç¾
  let selectedQuizType = 'problem'; // å„²å­˜é¸æ“‡çš„é¡å‹

  // å…¨åŸŸ DOM å…ƒç´ å®¹å™¨ï¼šåœ¨ initializeQuiz è¼‰å…¥å¾Œï¼Œæ‰€æœ‰å‡½æ•¸éƒ½å°‡é€éé€™å€‹ç‰©ä»¶è¨ªå•å…ƒç´ 
  let domRefs = {};
       /**
         * æ ¹æ“šé¸æ“‡çš„é¡å‹é–‹å§‹æ¸¬é©—
         * @param {string} quizType - 'problem' or 'solution'
         */
        function startQuiz(quizType) {
            selectedQuizType = quizType;
            // æ ¹æ“šé¸æ“‡çš„é¡å‹è¼‰å…¥å°æ‡‰çš„é¡Œç›®é›†
            if (quizType === 'problem') {
                // *** é¡Œç›®é †åºå›ºå®šï¼Œä¸éš¨æ©Ÿæ’åº ***
                currentQuestions = PROBLEM_STEPS_DATA.flatMap(step => step.quiz);
                domRefs.mainTitle.innerHTML = 'ğŸ› ï¸ QCC å•é¡Œè§£æ±ºå‹æŒ‘æˆ° ğŸ¯';
            } else if (quizType === 'solution') {
                // *** é¡Œç›®é †åºå›ºå®šï¼Œä¸éš¨æ©Ÿæ’åº ***
                currentQuestions = SOLUTION_STEPS_DATA.flatMap(step => step.quiz);
                domRefs.mainTitle.innerHTML = 'âœ¨ QCC èª²é¡Œé”æˆå‹æŒ‘æˆ° ğŸš€';
            }

            // éš±è—æ­¡è¿ç•«é¢ï¼Œé¡¯ç¤ºæ¸¬é©—å€å¡Š
            domRefs.welcomeScreen.classList.add('hidden');
            domRefs.progressSection.classList.remove('hidden');
            domRefs.quizContainer.classList.remove('hidden');

            currentQuestionIndex = 0; 
            quizInProgress = true;
            displayQuestion();
            domRefs.mainActionBtn.textContent = 'é€²è¡Œä¸‹ä¸€é¡Œ';
            domRefs.mainActionBtn.disabled = true;
            // éœ€å…ˆé¸æ“‡ç­”æ¡ˆæ‰èƒ½ç¹¼çºŒ
            domRefs.resultContainer.classList.add('hidden');
        }

        /**
         * é¡¯ç¤ºç•¶å‰é¡Œç›®
         */
        function displayQuestion() {
            const currentQuestion = currentQuestions[currentQuestionIndex];
            // æ›´æ–°é€²åº¦é¡¯ç¤º
            updateProgressDisplay();
            // æ›´æ–°é¡Œç›®
            // ç”±æ–¼é¡Œç›®å…§å®¹ç¾åœ¨å¯èƒ½åŒ…å« HTML æ¨™ç±¤ï¼Œæˆ‘å€‘ç›´æ¥ä½¿ç”¨ innerHTML
            domRefs.quizQuestion.innerHTML = `<span class="text-pink-500">[${currentQuestion.step}]</span> ${currentQuestion.question}`;
            // æ›´æ–°é¸é …
            domRefs.quizOptions.innerHTML = '';
            currentQuestion.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                // æ‡‰ç”¨å¤§å€å¡Šæ¨£å¼
                optionElement.className = `answer-option bg-white p-5 md:p-6 rounded-xl shadow-md hover:shadow-lg transition-all duration-300 border-purple-200 text-lg md:text-xl font-medium text-gray-700`;
                optionElement.innerHTML = `
            
                    <!-- START: æ ¹æ“šç”¨æˆ¶éœ€æ±‚ä¿®æ”¹çš„åœˆåœˆæ¨£å¼ -->
                    <!-- ä½¿ç”¨ inline-flex å’Œ items-center/justify-center å¯¦ç¾å®Œç¾ç½®ä¸­ -->
                    <!-- ä½¿ç”¨ w-8 h-8 å¢å¤§åœˆåœˆå°ºå¯¸ -->
                    <span class="inline-flex items-center justify-center w-8 h-8 bg-purple-100 text-purple-700 rounded-full mr-3 border-2 border-purple-400 font-extrabold text-lg">${String.fromCharCode(65 + index)}</span>
                    <!-- END: æ ¹æ“šç”¨æˆ¶éœ€æ±‚ä¿®æ”¹çš„åœˆåœˆæ¨£å¼ -->
                    ${option}
                `;
                optionElement.dataset.index = index;
                
         
               // åŠ ä¸Šé»æ“Šäº‹ä»¶
                optionElement.addEventListener('click', () => selectAnswer(index, optionElement, currentQuestion));
                domRefs.quizOptions.appendChild(optionElement);
            });
            // ç¢ºä¿å›é¥‹å€å¡Šæ˜¯éš±è—çš„
            domRefs.quizFeedback.classList.add('hidden');
            // æ¸…é™¤ä¸Šæ¬¡çš„æŒ‰éˆ•ç‹€æ…‹ï¼Œé‡æ–°ç¶å®šé¸é …é»æ“Š
            domRefs.quizOptions.querySelectorAll('.answer-option').forEach(el => el.classList.remove('disabled'));
        }

        /**
         * è™•ç†ç”¨æˆ¶é»æ“Šç­”æ¡ˆçš„äº‹ä»¶
         * @param {number} selectedIndex - ç”¨æˆ¶é¸æ“‡çš„é¸é …ç´¢å¼•
         * @param {HTMLElement} selectedElement - ç”¨æˆ¶é»æ“Šçš„é¸é … DOM å…ƒç´ 
         * @param {object} questionData - ç•¶å‰å•é¡Œçš„è³‡æ–™
         */
        function selectAnswer(selectedIndex, selectedElement, questionData) {
            const correct = selectedIndex === 
                questionData.correctAnswerIndex;
            
            // 1. ç¦ç”¨æ‰€æœ‰é¸é …ï¼Œé˜²æ­¢é‡è¤‡é»æ“Š
            domRefs.quizOptions.querySelectorAll('.answer-option').forEach(el => {
                el.classList.add('disabled');
                // ç§»é™¤åŸæœ‰çš„ hover æ•ˆæœ
                el.classList.remove('hover:shadow-lg', 'hover:shadow-lg', 'hover:shadow-2xl');
                el.style.pointerEvents = 'none'; // å¾¹åº•ç¦ç”¨
          
            });

            // 2. è™•ç†åˆ†æ•¸å’Œè¿½è¹¤
            const stepName = questionData.step;
            if (stepPerformance[stepName] === undefined) {
                 stepPerformance[stepName] = { correct: 0, total: 0 };
            }
            stepPerformance[stepName].total++;
            // 3. çµ¦äºˆèª‡å¼µçš„è¦–è¦ºå›é¥‹
            let feedbackText = '';
            let feedbackClass = '';

            if (correct) {
                userScore++;
                stepPerformance[stepName].correct++;
                // åŠ ä¸Šæ­£ç¢ºç­”æ¡ˆçš„é–ƒçˆå‹•ç•«
                selectedElement.classList.add('correct-blink');
                feedbackText = `<span class="text-3xl mr-3">ğŸ‰</span> ${questionData.feedback_correct || "ğŸ¯ ç­”å°äº†ï¼ä½ çœŸæ˜¯å€‹ QCC å°å¤©æ‰ï¼"}`;
                feedbackClass = 'bg-green-50 text-green-700 border-green-500 shadow-green-200';
            } else {
                // åŠ ä¸ŠéŒ¯èª¤ç­”æ¡ˆçš„æ™ƒå‹•å‹•ç•«
                selectedElement.classList.add('incorrect-shake');
                // æ¨™ç¤ºå‡ºæ­£ç¢ºç­”æ¡ˆ
                const correctElement = domRefs.quizOptions.querySelector(`[data-index="${questionData.correctAnswerIndex}"]`);
                if (correctElement) {
                    correctElement.classList.remove('bg-white', 'border-purple-200');
                    correctElement.classList.add('bg-green-200', 'border-green-500', 'shadow-inner');
                }

                feedbackText = `<span class="text-3xl mr-3">âŒ</span> ${questionData.feedback_incorrect ||
                    "ğŸ’¡ ç­”éŒ¯äº†ï¼æ²’é—œä¿‚ï¼Œçœ‹çœ‹æ­£ç¢ºç­”æ¡ˆæ˜¯å“ªä¸€å€‹ï¼"}`;
                feedbackClass = 'bg-red-50 text-red-700 border-red-500 shadow-red-200';
            }
            
            // 4. é¡¯ç¤ºå›é¥‹å€å¡Š
            domRefs.quizFeedback.className = `mt-6 p-4 text-center rounded-xl font-bold transition-all duration-300 transform scale-100 border-2 ${feedbackClass}`;
            domRefs.quizFeedback.innerHTML = feedbackText;
            domRefs.quizFeedback.classList.remove('hidden');

            // 5. å•Ÿç”¨ä¸»è¦æŒ‰éˆ•ï¼Œè®“ç”¨æˆ¶æ‰‹å‹•é»æ“Šä¸‹ä¸€é¡Œ
            domRefs.mainActionBtn.textContent = (currentQuestionIndex < currentQuestions.length - 1) ?
                'ç¹¼çºŒä¸‹ä¸€é¡Œ' : 'æŸ¥çœ‹æœ€çµ‚æˆæœï¼';
            domRefs.mainActionBtn.disabled = false;
        }

        /**
         * æ›´æ–°é€²åº¦æ¢å’Œæ–‡å­—é¡¯ç¤º
         */
        function updateProgressDisplay() {
            const total = currentQuestions.length;
            const current = currentQuestionIndex + 1;
            const percentage = (current / total) * 100;
            domRefs.progressDisplay.textContent = `ç¬¬ ${current} é¡Œ / å…± ${total} é¡Œ | ç›®å‰å¾—åˆ†: ${userScore} åˆ†`;
            domRefs.progressBar.style.width = `${percentage}%`;
        }

        /**
         * é¡¯ç¤ºæœ€çµ‚çµæœå’Œåˆ†æ
         */
        function showResults() {
            quizInProgress = false;
            domRefs.quizContainer.classList.add('hidden');
            domRefs.progressSection.classList.add('hidden'); // éš±è—é€²åº¦æ¢
            domRefs.resultContainer.classList.remove('hidden');
            
            const totalQuestions = currentQuestions.length;
            const percentage = Math.round((userScore / totalQuestions) * 100);

            let resultTitle = '';
            let resultClass = '';
            let resultText = '';
            // æ ¹æ“šé¸æ“‡çš„é¡å‹å¾®èª¿çµæœæè¿°
            const typeLabel = selectedQuizType === 'problem' ?
                'å•é¡Œè§£æ±ºå‹' : 'èª²é¡Œé”æˆå‹';
            const stepData = selectedQuizType === 'problem' ? PROBLEM_STEPS_DATA : SOLUTION_STEPS_DATA;
            if (percentage >= 90) {
                resultTitle = 'ğŸ‰ å‚³å¥‡å¤§å¸«ç´šï¼';
                resultText = `ä½ åœ¨ ${typeLabel} é ˜åŸŸçš„ QCC çŸ¥è­˜å·²é”é ‚å°–æ°´å¹³ï¼æ‰€æœ‰æ­¥é©Ÿéƒ½æŒæ¡å¾—éå¸¸ç´®å¯¦ï¼Œå¯ä»¥æ“”ä»»å°å¸«äº†ï¼`;
                resultClass = 'text-green-700 border-green-500 bg-green-100';
            } else if (percentage >= 70) {
                resultTitle = 'ğŸ‘ å„ªç§€å¯¦å‹™å®¶ï¼';
                resultText = `è¡¨ç¾éå¸¸æ£’ï¼ä½ å° ${typeLabel} çš„æ ¸å¿ƒæ­¥é©Ÿæœ‰å¾ˆå¥½çš„ç†è§£ï¼Œåªéœ€è¦åœ¨ç´°ç¯€è™•å†åŠ å¼·å°±èƒ½æ›´å®Œç¾ã€‚`;
                resultClass = 'text-blue-700 border-blue-500 bg-blue-100';
            } else if (percentage >= 50) {
                resultTitle = 'ğŸ§ ç©©å¥å­¸ç¿’ä¸­ï¼';
                resultText = `ä½ å·²ç¶“æŒæ¡äº† ${typeLabel} å¤§éƒ¨åˆ†çŸ¥è­˜ï¼Œä½†é‚„æœ‰ä¸€äº›æ­¥é©Ÿéœ€è¦å›é ­è¤‡ç¿’ã€‚ç¹¼çºŒåŠªåŠ›ï¼`;
                resultClass = 'text-yellow-700 border-yellow-500 bg-yellow-100';
            } else {
                resultTitle = 'ğŸš€ æŒ‘æˆ°è€…æ¨¡å¼ï¼';
                resultText = `æ²’é—œä¿‚ï¼Œé€™åªæ˜¯é–‹å§‹ï¼é€éé€™æ¬¡ ${typeLabel} æ¸¬é©—ï¼Œä½ çŸ¥é“è©²å¾ ${typeLabel} çš„å“ªå€‹æ­¥é©Ÿè£œå¼·äº†ï¼`;
                resultClass = 'text-red-700 border-red-500 bg-red-100';
            }

            // å¼±é»åˆ†æ HTML
            let analysisHTML = `
                <h3 class="text-2xl font-bold text-gray-700 mt-8 mb-4 border-b-2 border-dashed pb-2">ğŸ§  çŸ¥è­˜å¼±é»åˆ†æ (${typeLabel})</h3>
                <p class="text-gray-600 mb-4">æ ¹æ“šä½ çš„ä½œç­”ï¼Œæˆ‘å€‘ç‚ºä½ åˆ†æäº†åœ¨ QCC ä¹å¤§æ­¥é©Ÿä¸­ï¼Œå“ªå€‹ç’°ç¯€å¯èƒ½éœ€è¦åŠ å¼·ï¼š</p>
                <ul class="space-y-3">
        
                `;

            // ç¢ºä¿æŒ‰é †åºé¡¯ç¤º 9 å€‹æ­¥é©Ÿçš„è¡¨ç¾ï¼Œä¸¦å¾ stepData ä¸­ç²å–æ­¥é©Ÿåç¨±
            stepData.forEach(step => {
                const stepName = step.name;
                
                // å¾ stepPerformance ä¸­å–å‡ºè¿½è¹¤çš„æ•¸æ“š
                const performance = stepPerformance[stepName] || { 
                    correct: 0, total: 0 };
                
                // ç”±æ–¼æ˜¯å–®ä¸€é¡Œç›®çš„æ¸¬é©—æ¨¡å¼ï¼Œtotal æ‡‰è©²æ˜¯ 1
                const totalInStep = 1; 
                
                if (performance.total > 0) {
     
                    const accuracy = (performance.correct / totalInStep) * 100;
                    let icon = 'ğŸŸ¢';
                    let textClass = 'text-green-600';
                    if (accuracy < 50) {
        
                        icon = 'ğŸ”´';
                        textClass = 'text-red-600 font-bold';
                    } else if (accuracy < 100) { 
                        icon = 'ğŸŸ¡';
  
                        textClass = 'text-yellow-600';
                    }

                    analysisHTML += `
                        <li class="flex items-center p-2 bg-gray-50 rounded-lg shadow-sm">
    
                            <span class="mr-3 text-xl">${icon}</span>
                            <span class="font-semibold w-1/3">${step.id}.
                                ${stepName}:</span>
                            <span class="${textClass}">${performance.correct} / ${totalInStep} é¡Œ (${accuracy.toFixed(0)}%)</span>
                        </li>
                    `;
                }
            });

            analysisHTML += `</ul>`;
            domRefs.resultContainer.innerHTML = `
                <!-- æ›´æ”¹: å¢å¤§çµæœæ¨™é¡Œå­—é«”è‡³ md:text-4xl -->
                <h2 class="text-4xl md:text-4xl font-extrabold text-center mb-4 ${resultClass}">${resultTitle}</h2>
                <!-- æ›´æ”¹: å¢å¤§ç¸½å¾—åˆ†å­—é«”è‡³ md:text-2xl -->
                <p class="text-center text-xl md:text-2xl text-gray-600 mb-6">ç¸½å¾—åˆ†ï¼š${userScore} / ${totalQuestions} é¡Œ</p>
                <!-- ğŸ¯ é€™è£¡ä¿®æ”¹äº†å­—é«”å¤§å°ï¼šå°‡ md:text-2xl æ”¹ç‚º md:text-xl -->
                <div class="p-4 rounded-xl ${resultClass} text-center font-semibold text-xl md:text-xl">
                    ${resultText}
            
                </div>
                
                ${analysisHTML} <!-- æ³¨å…¥å¼±é»åˆ†æå€å¡Š -->
                
                <button id="restartQuizBtn" class="fun-action-btn w-full mt-8 py-4 text-2xl font-bold rounded-xl shadow-lg hover:shadow-2xl">
                   
                    å†ä¾†ä¸€è¼ªæŒ‘æˆ°ï¼
                </button>
            `;
            // é‡æ–°é–‹å§‹åŠŸèƒ½ï¼šç¶å®šåˆ°æ–°çš„æŒ‰éˆ•ä¸Š
            document.getElementById('restartQuizBtn').addEventListener('click', initializeQuiz);
            // ç¢ºä¿ä¸»æŒ‰éˆ•è¢«ç§»é™¤äº‹ä»¶ä¸¦ä¿æŒéš±è—
            domRefs.mainActionBtn.removeEventListener('click', handleMainAction);
        }
        
        // éš¨æ©Ÿæ‰“äº‚æ•¸çµ„ (ç¾åœ¨æœªè¢«ä½¿ç”¨ï¼Œä½†ä¿ç•™ä»¥é˜²æœªä¾†éœ€è¦)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        /**
         * åˆå§‹åŒ–æ¸¬é©—ç‹€æ…‹å’Œ UI (ç¾åœ¨æ˜¯é¡å‹é¸æ“‡ç•«é¢)
         */
        function initializeQuiz() {
            // 1. ç²å–æ‰€æœ‰ DOM å…ƒç´ ä¸¦å„²å­˜åˆ° domRefs
            domRefs.mainTitle = document.getElementById('mainTitle');
            domRefs.welcomeScreen = document.getElementById('welcomeScreen');
            domRefs.progressSection = document.getElementById('progressSection');
            domRefs.quizContainer = document.getElementById('quizContainer');
            domRefs.quizQuestion = document.getElementById('quizQuestion');
            domRefs.quizOptions = document.getElementById('quizOptions');
            domRefs.quizFeedback = document.getElementById('quizFeedback');
            domRefs.mainActionBtn = document.getElementById('mainActionBtn');
            domRefs.progressDisplay = document.getElementById('progressDisplay');
            domRefs.progressBar = document.getElementById('progressBar');
            domRefs.resultContainer = document.getElementById('resultContainer');

            const selectProblemType = document.getElementById('selectProblemType'); 
            const selectSolutionType = document.getElementById('selectSolutionType');

            // 2. é‡ç½®ç‹€æ…‹è®Šæ•¸
            currentQuestionIndex = -1;
            userScore = 0;
            quizInProgress = false;
            stepPerformance = {}; 
            selectedQuizType = 'problem'; 
            currentQuestions = []; 

            // 3. é‡ç½® UI é¡¯ç¤º
            domRefs.mainTitle.innerHTML = 'ğŸ› ï¸ QCC çŸ¥è­˜é»é»å ğŸ¯';
            domRefs.welcomeScreen.classList.remove('hidden');
            domRefs.progressSection.classList.add('hidden');
            domRefs.quizContainer.classList.add('hidden');
            domRefs.resultContainer.classList.add('hidden');

            // 4. ç¶å®šé¡å‹é¸æ“‡æŒ‰éˆ•äº‹ä»¶
            if (selectProblemType && selectSolutionType) {
                // å…ˆç§»é™¤èˆŠçš„ï¼Œå†ç¶å®šæ–°çš„ (é˜²æ­¢é‡è¤‡ç¶å®š)
                selectProblemType.onclick = null; 
                selectSolutionType.onclick = null;
                selectProblemType.onclick = () => startQuiz('problem');
                selectSolutionType.onclick = () => startQuiz('solution');
            }
            
            // 5. ç¶å®šä¸»è¦å‹•ä½œæŒ‰éˆ• (in-quiz flow)
            // ç¢ºä¿æ¯æ¬¡é‡ç½®éƒ½èƒ½æ­£ç¢ºç¶å®šåˆ° handleMainAction
            domRefs.mainActionBtn.removeEventListener('click', handleMainAction);
            domRefs.mainActionBtn.addEventListener('click', handleMainAction);
        }

        // é é¢è¼‰å…¥æ™‚åŸ·è¡Œåˆå§‹åŒ–
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeQuiz);
        } else {
            initializeQuiz();
        }


</script>

</body>
</html>
