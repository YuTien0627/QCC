<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QCC çŸ¥è­˜é»é»å</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ä½¿ç”¨ Noto Sans TC ç¢ºä¿ä¸­æ–‡é¡¯ç¤ºç¾è§€ä¸”è¦ªåˆ‡ -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght=500;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f7f3f9; /* æŸ”å’ŒèƒŒæ™¯è‰² */
        }

        /* éŠæˆ²åŒ–å€å¡Šå®¹å™¨æ¨£å¼ */
        .quiz-card {
            background: linear-gradient(135deg, #ffffff 0%, #fef3c7 100%);
            border-radius: 2rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15), 0 0 0 8px #f5d0fe; /* èª‡å¼µé‚Šæ¡†/é™°å½± */
            max-width: 900px;
            width: 95%;
            margin: 0 auto;
        }

        /* QCC Type Selection Button Style (æ–°æ¨£å¼) */
        .quiz-type-btn {
            color: white;
            padding: 2.5rem 2rem;
            border-radius: 1.5rem;
            font-weight: 700;
            font-size: 1.5rem;
            transition: all 0.3s ease;
            transform: scale(1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        .quiz-type-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        /* å‹•ä½œæŒ‰éˆ•çš„éŠæˆ²åŒ–æ¨£å¼ */
        .fun-action-btn {
            background-image: linear-gradient(45deg, #a855f7, #ec4899);
            color: white;
            transition: all 0.3s ease;
        }

        .fun-action-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(168, 85, 247, 0.4);
        }
        
        .fun-action-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background-image: linear-gradient(45deg, #9ca3af, #6b7280);
        }

        /* é¸é …æ¨£å¼ */
        .answer-option {
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            border: 3px solid;
            transform: scale(1);
        }
        
        .answer-option:hover:not(.disabled) {
            transform: scale(1.02);
            box-shadow: 0 8px 20px rgba(168, 85, 247, 0.2) !important;
            border-color: #a855f7;
        }

        /* éŒ¯èª¤å‹•ç•« */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }
        .incorrect-shake {
            animation: shake 0.4s ease-in-out;
            background-color: #fee2e2 !important;
            border-color: #ef4444 !important;
        }

        /* æ­£ç¢ºå‹•ç•« (é–ƒçˆ) */
        @keyframes blink {
            0%, 100% { background-color: #d1fae5; border-color: #10b981; }
            50% { background-color: #6ee7b7; border-color: #059669; }
        }
        .correct-blink {
            animation: blink 0.6s 3; /* é–ƒçˆ 3 æ¬¡ */
        }

        /* ç¦ç”¨ç‹€æ…‹çš„é¸é … */
        .disabled {
            opacity: 0.8;
            cursor: default !important;
        }

    </style>
</head>
<body class="min-h-screen p-4 md:p-8">
    <main class="quiz-card p-6 md:p-10 my-10">
        <h1 id="mainTitle" class="text-4xl font-extrabold text-center text-purple-800 mb-8 border-b-4 border-pink-300 pb-3">
            ğŸ› ï¸ QCC çŸ¥è­˜é»é»å ğŸ¯
        </h1>

        <!-- é€²åº¦æ¢å€å¡Š (é è¨­éš±è—) -->
        <div id="progressSection" class="hidden mb-6">
            <p id="progressDisplay" class="text-center text-lg font-semibold text-gray-700 mb-2">
                ç¬¬ 0 é¡Œ / å…± 0 é¡Œ | ç›®å‰å¾—åˆ†: 0 åˆ†
            </p>
            <div class="w-full bg-gray-200 rounded-full h-3">
                <div id="progressBar" class="bg-pink-500 h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>
        </div>

        <!-- 1. æ­¡è¿/é¡å‹é¸æ“‡ç•«é¢ -->
        <div id="welcomeScreen" class="text-center">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">æ­¡è¿æŒ‘æˆ° QCC ä¹å¤§æ­¥é©ŸçŸ¥è­˜ï¼</h2>
            <p class="text-xl text-gray-600 mb-10">è«‹é¸æ“‡æ‚¨è¦æŒ‘æˆ°çš„ QCC é¡å‹ï¼š</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <button id="selectProblemType" class="quiz-type-btn bg-red-500 hover:bg-red-600">
                    <span class="text-4xl block mb-2">ğŸš¨</span>
                    å•é¡Œè§£æ±ºå‹ QCC
                    <span class="text-sm block mt-2 opacity-80">(PDCA æ¨¡å¼)</span>
                </button>
                <button id="selectSolutionType" class="quiz-type-btn bg-blue-500 hover:bg-blue-600">
                    <span class="text-4xl block mb-2">ğŸ’¡</span>
                    èª²é¡Œé”æˆå‹ QCC
                    <span class="text-sm block mt-2 opacity-80">(SDCA æ¨¡å¼)</span>
                </button>
            </div>
        </div>

        <!-- 2. æ¸¬é©—ä¸»å€å¡Š (é è¨­éš±è—) -->
        <div id="quizContainer" class="hidden">
            <!-- é¡Œç›®å€ -->
            <div class="min-h-[100px] mb-8 bg-purple-50 p-6 md:p-8 rounded-2xl border-4 border-purple-300 shadow-xl">
                <h2 id="quizQuestion" class="text-2xl md:text-3xl font-extrabold text-gray-800 leading-relaxed">
                    <!-- é¡Œç›®å…§å®¹å°‡åœ¨æ­¤è™•é¡¯ç¤º -->
                </h2>
            </div>

            <!-- é¸é …å€ -->
            <div id="quizOptions" class="space-y-4 md:space-y-5">
                <!-- é¸é …å…ƒç´ å°‡åœ¨æ­¤è™•å‹•æ…‹ç”Ÿæˆ -->
            </div>

            <!-- å›é¥‹å€ (é è¨­éš±è—) -->
            <div id="quizFeedback" class="hidden">
                <!-- å›é¥‹å…§å®¹å°‡åœ¨æ­¤è™•é¡¯ç¤º -->
            </div>
            
            <!-- ä¸‹ä¸€é¡ŒæŒ‰éˆ• -->
            <button id="mainActionBtn" class="fun-action-btn w-full mt-8 py-4 text-xl font-bold rounded-xl shadow-lg" disabled>
                æº–å‚™å¥½äº†ï¼Œé–‹å§‹ç­”é¡Œï¼
            </button>
        </div>

        <!-- 3. çµæœå€å¡Š (é è¨­éš±è—) -->
        <div id="resultContainer" class="hidden text-center">
            <!-- çµæœå…§å®¹å°‡åœ¨æ­¤è™•å‹•æ…‹ç”Ÿæˆ -->
        </div>

    </main>

    <script>
        // =========================================================================
        // QCC æ¸¬é©—æ•¸æ“šçµæ§‹
        // =========================================================================

        const PROBLEM_STEPS_DATA = [
            { id: 1, name: "ä¸»é¡Œé¸å®š" }, { id: 2, name: "è¨­å®šç›®æ¨™" }, { id: 3, name: "æ“¬å®šæ´»å‹•è¨ˆç•«" },
            { id: 4, name: "ç¾æ³æŒæ¡èˆ‡åˆ†æ" }, { id: 5, name: "è§£æèˆ‡å°ç­–æ“¬å®š" }, { id: 6, name: "å°ç­–å¯¦æ–½" },
            { id: 7, name: "æ•ˆæœç¢ºèª" }, { id: 8, name: "æ¨™æº–åŒ–èˆ‡åˆ¶åº¦åŒ–" }, { id: 9, name: "æª¢è¨èˆ‡åçœ" }
        ];

        const SOLUTION_STEPS_DATA = [
            { id: 1, name: "ä¸»é¡Œé¸å®š" }, { id: 2, name: "ç¾æ³èª¿æŸ¥" }, { id: 3, name: "ç›®æ¨™è¨­å®š" },
            { id: 4, name: "æ´»å‹•è¨ˆåŠƒæ“¬å®š" }, { id: 5, name: "è§£æèˆ‡å°ç­–æ“¬å®š" }, { id: 6, name: "å°ç­–å¯¦æ–½" },
            { id: 7, name: "æ•ˆæœç¢ºèª" }, { id: 8, name: "æ¨™æº–åŒ–èˆ‡åˆ¶åº¦åŒ–" }, { id: 9, name: "æª¢è¨èˆ‡åçœ" }
        ];

        const PROBLEM_QUESTIONS = [
            {
                step: "ç¾æ³æŒæ¡èˆ‡åˆ†æ",
                question: "åœ¨ã€Œç¾æ³æŒæ¡èˆ‡åˆ†æã€éšæ®µï¼Œå°çµ„æ‡‰è©²å„ªå…ˆåŸ·è¡Œå“ªé …å·¥ä½œï¼Ÿ",
                options: [
                    "è¨ˆç®—æ”¹å–„å¾Œé è¨ˆé”æˆçš„æ•ˆç›Šé‡‘é¡ã€‚",
                    "åˆ©ç”¨æŸæ‹‰åœ–æˆ–è¶¨å‹¢åœ–ï¼Œé‡åŒ–å‘ˆç¾å•é¡Œç¾ç‹€ï¼Œä¸¦è¿½æº¯æ ¹æœ¬åŸå› ã€‚",
                    "åˆ¶å®šä¸‹å€‹æœˆçš„æ´»å‹•è¡Œç¨‹è¡¨ã€‚",
                    "å°‡å·²ç¢ºèªçš„å°ç­–é–‹å§‹é€²è¡Œå¯¦æ–½ã€‚"
                ],
                correctAnswerIndex: 1,
                feedback_correct: "ğŸ¯ å®Œç¾ï¼ç¾æ³æŒæ¡æ ¸å¿ƒæ˜¯ã€Œé‡åŒ–ã€å•é¡Œä¸¦ã€Œåˆ†æã€åŸå› ã€‚",
                feedback_incorrect: "ğŸ’¡ éŒ¯èª¤ï¼ç¾æ³æŒæ¡çš„é‡é»æ˜¯é‡åŒ–å•é¡Œï¼Œä¸¦é€éçµ±è¨ˆå·¥å…·(å¦‚æŸæ‹‰åœ–)æ‰¾å‡ºä¸»è¦å•é¡Œï¼Œç‚ºå¾ŒçºŒè§£ææ‰“åŸºç¤ã€‚"
            },
            {
                step: "æ¨™æº–åŒ–èˆ‡åˆ¶åº¦åŒ–",
                question: "å®Œæˆå°ç­–å¯¦æ–½ä¸¦ç¢ºèªæ•ˆæœå¾Œï¼Œç‚ºäº†é¿å…å•é¡Œå†æ¬¡ç™¼ç”Ÿï¼Œæœ€é—œéµçš„ä¸‹ä¸€æ­¥æ˜¯ï¼Ÿ",
                options: [
                    "é–‹å§‹é¸æ“‡ä¸‹ä¸€å€‹ QCC ä¸»é¡Œã€‚",
                    "å°‡æˆåŠŸçš„å°ç­–ç´å…¥æ¨™æº–ä½œæ¥­æµç¨‹ï¼ˆSOPï¼‰ã€æ•™è‚²è¨“ç·´æˆ–è¦ç« åˆ¶åº¦ä¸­ã€‚",
                    "å¬é–‹æˆæœç™¼è¡¨æœƒï¼Œæ…¶ç¥æ´»å‹•æˆåŠŸã€‚",
                    "å°‡æ‰€æœ‰å‰©é¤˜çš„è³‡æºåˆ†é…çµ¦å…¶ä»–å°çµ„ã€‚"
                ],
                correctAnswerIndex: 1,
                feedback_correct: "ğŸ¯ ç­”å°äº†ï¼æ¨™æº–åŒ–æ˜¯ç¶­æŒæ”¹å–„æˆæœï¼Œé˜²æ­¢å†ç™¼çš„å¿…è¦æ‰‹æ®µï¼",
                feedback_incorrect: "ğŸ’¡ éŒ¯èª¤ï¼æ¨™æº–åŒ–æ˜¯ QCC çš„é—œéµç’°ç¯€ï¼Œæ—¨åœ¨å°‡æœ€ä½³å¯¦è¸å›ºåŒ–ç‚ºåˆ¶åº¦ï¼Œé˜²æ­¢å“è³ªå€’é€€ã€‚"
            },
            {
                step: "è¨­å®šç›®æ¨™",
                question: "QCC ç›®æ¨™è¨­å®šæ™‚ï¼Œæ‡‰è©²éµå¾ª SMART åŸå‰‡ï¼Œè«‹å•ã€ŒMã€ä»£è¡¨ä»€éº¼æ„æ€ï¼Ÿ",
                options: [
                    "Maintainable (å¯ç¶­è­·çš„)",
                    "Measurable (å¯é‡æ¸¬çš„)",
                    "Motivating (é¼“èˆäººå¿ƒçš„)",
                    "Management-approved (ç¶“ç®¡ç†å±¤æ‰¹å‡†çš„)"
                ],
                correctAnswerIndex: 1,
                feedback_correct: "ğŸ¯ æ²’éŒ¯ï¼å¯é‡æ¸¬æ€§ (Measurable) ç¢ºä¿ç›®æ¨™å¯ä»¥è¢«å®¢è§€è©•ä¼°ã€‚",
                feedback_incorrect: "ğŸ’¡ éŒ¯èª¤ï¼SMART ä¸­çš„ M æŒ‡çš„æ˜¯ Measurable (å¯é‡æ¸¬çš„)ï¼Œç›®æ¨™å¿…é ˆèƒ½è¢«æ•¸å­—è¡¡é‡ï¼"
            },
            {
                step: "ä¸»é¡Œé¸å®š",
                question: "é¸æ“‡ QCC ä¸»é¡Œæ™‚ï¼Œå“ªä¸€å€‹é¸é …æœ€ç¬¦åˆã€Œå…·é«”æ€§ã€å’Œã€Œæ•ˆç›Šæ€§ã€åŸå‰‡ï¼Ÿ",
                options: [
                    "æå‡å…¬å¸æ•´é«”å½¢è±¡",
                    "é™ä½ç”¢å“ X çµ„è£ç·šçš„å·¥æ™‚ï¼Œå¾ 180 ç§’/ä»¶é™è‡³ 150 ç§’/ä»¶",
                    "æ¸›å°‘å“¡å·¥æŠ±æ€¨çš„æ¬¡æ•¸",
                    "å„ªåŒ–çµ„ç¹”æºé€šæµç¨‹"
                ],
                correctAnswerIndex: 1,
                feedback_correct: "ğŸ¯ å¤ªæ£’äº†ï¼é€™æ˜¯æœ€å…·é«”ä¸”ç›®æ¨™æ¸…æ™°çš„ä¸»é¡Œã€‚",
                feedback_incorrect: "ğŸ’¡ éŒ¯èª¤ï¼QCC ä¸»é¡Œæ‡‰å…·é«”åˆ°èƒ½æ•¸å­—åŒ–è¡¡é‡ï¼Œä¾‹å¦‚ã€Œé™ä½å·¥æ™‚ã€æˆ–ã€Œæ¸›å°‘ä¸è‰¯ç‡ã€ã€‚"
            }
        ];

        const SOLUTION_QUESTIONS = [
            {
                step: "ç¾æ³èª¿æŸ¥",
                question: "åœ¨ã€Œèª²é¡Œé”æˆå‹ã€QCC çš„ã€Œç¾æ³èª¿æŸ¥ã€éšæ®µï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯ä»€éº¼ï¼Ÿ",
                options: [
                    "åˆ†æéå»å·²ç¶“ç™¼ç”Ÿçš„ä¸è‰¯å“åŸå› ã€‚",
                    "ç™¼æ˜æ–°ç”¢å“æˆ–æœå‹™çš„æ½›åœ¨æ©Ÿæœƒé»ï¼Œç¢ºèªèˆ‡ç›®æ¨™çš„å·®è·ã€‚",
                    "è¨ˆç®—å°çµ„æˆå“¡çš„å¹³å‡ç¸¾æ•ˆã€‚",
                    "å°å¸‚å ´ç«¶çˆ­è€…é€²è¡Œå…¨é¢çš„åƒ¹æ ¼æˆ°åˆ†æã€‚"
                ],
                correctAnswerIndex: 1,
                feedback_correct: "ğŸ¯ å®Œç¾ï¼èª²é¡Œé”æˆå‹å°ˆæ³¨æ–¼å‰µé€ æ–°çš„åƒ¹å€¼èˆ‡æ©Ÿæœƒï¼",
                feedback_incorrect: "ğŸ’¡ éŒ¯èª¤ï¼èª²é¡Œé”æˆå‹ç¾æ³èª¿æŸ¥æ˜¯ç‚ºäº†ç™¼æ˜ã€Œæ½›åœ¨ã€æ”¹å–„æ©Ÿæœƒï¼Œä¸æ˜¯è§£æ±ºå·²ç™¼ç”Ÿå•é¡Œï¼ˆé‚£æ˜¯å•é¡Œè§£æ±ºå‹ï¼‰ã€‚"
            },
            {
                step: "è§£æèˆ‡å°ç­–æ“¬å®š",
                question: "è‹¥ä¸»é¡Œæ˜¯ã€Œé–‹ç™¼ä¸€æ¬¾æ›´ç’°ä¿çš„åŒ…è£ææ–™ã€ï¼Œåœ¨å“ªå€‹å­æ­¥é©Ÿä¸­æœƒé€²è¡Œã€Œé ­è…¦é¢¨æš´ã€æˆ–ã€Œç³»çµ±æ€è€ƒã€ä¾†æå‡ºå¤šç¨®å¯¦æ–½æ–¹æ¡ˆï¼Ÿ",
                options: [
                    "æ“¬å®šæ´»å‹•è¨ˆç•«",
                    "å°ç­–å¯¦æ–½",
                    "è§£æèˆ‡å°ç­–æ“¬å®š",
                    "æ•ˆæœç¢ºèª"
                ],
                correctAnswerIndex: 2,
                feedback_correct: "ğŸ¯ ç­”å°äº†ï¼å°ç­–æ“¬å®šæ˜¯å‰µæ„ç™¼æƒ³èˆ‡æ–¹æ¡ˆç¯©é¸çš„æ ¸å¿ƒæ­¥é©Ÿã€‚",
                feedback_incorrect: "ğŸ’¡ éŒ¯èª¤ï¼åœ¨ã€Œè§£æèˆ‡å°ç­–æ“¬å®šã€ä¸­ï¼Œä½ æœƒåˆ©ç”¨å„ç¨®æ–¹æ³•ï¼ˆå¦‚è…¦åŠ›æ¿€ç›ªï¼‰ä¾†ç”¢ç”Ÿã€è©•ä¼°ä¸¦é¸å®šæœ€ä½³å°ç­–ã€‚"
            },
            {
                step: "ç›®æ¨™è¨­å®š",
                question: "èª²é¡Œé”æˆå‹çš„ç›®æ¨™è¨­å®šé€šå¸¸æ¯”å•é¡Œè§£æ±ºå‹æ›´å…·æŒ‘æˆ°æ€§ï¼Œç‚ºä»€éº¼ï¼Ÿ",
                options: [
                    "å› ç‚ºèª²é¡Œé”æˆå‹ä¸ä½¿ç”¨çµ±è¨ˆå·¥å…·ã€‚",
                    "å› ç‚ºå®ƒè‘—é‡æ–¼å¾ã€Œé›¶ã€æˆ–ã€Œç¾æœ‰æ¨™æº–ã€ä¸Šå‰µé€ ã€Œçªç ´æ€§ã€æˆ–ã€Œå‰µæ–°ã€çš„æˆæœã€‚",
                    "å› ç‚ºå®ƒé€šå¸¸ç”±é«˜éšä¸»ç®¡ç›´æ¥æŒ‡å®šã€‚",
                    "å› ç‚ºå®ƒçš„æ´»å‹•æ™‚é–“è¼ƒçŸ­ï¼Œå¿…é ˆè¿…é€Ÿå®Œæˆã€‚"
                ],
                correctAnswerIndex: 1,
                feedback_correct: "ğŸ¯ æ²’éŒ¯ï¼èª²é¡Œé”æˆè¿½æ±‚å“è¶Šå’Œå‰µæ–°ï¼Œç›®æ¨™é€šå¸¸æ˜¯è·³èºå¼çš„ã€‚",
                feedback_incorrect: "ğŸ’¡ éŒ¯èª¤ï¼èª²é¡Œé”æˆå‹è¿½æ±‚çš„æ˜¯å‰µæ–°å’Œçªç ´ï¼Œç›®æ¨™è¨­å®šå¾€å¾€æ˜¯æŒ‘æˆ°æ€§æ›´é«˜çš„åŸºæº–ã€‚"
            },
            {
                step: "æ´»å‹•è¨ˆåŠƒæ“¬å®š",
                question: "åœ¨æ´»å‹•è¨ˆç•«æ“¬å®šä¸­ï¼Œå°çµ„æœ€æ‡‰è©²å„ªå…ˆæ˜ç¢ºçš„æ˜¯ä»€éº¼ï¼Ÿ",
                options: [
                    "æœ€çµ‚çš„æˆæœå±•ç¤ºæ–¹å¼ã€‚",
                    "ä¸»é¡Œé¸å®šçš„èƒŒæ™¯èˆ‡å‹•æ©Ÿã€‚",
                    "èª°è² è²¬ã€ä»€éº¼æ™‚å€™å®Œæˆã€æ€éº¼å®Œæˆï¼ˆäººã€æ™‚ã€äº‹ã€åœ°ã€æ³•ï¼‰çš„å…·é«”åˆ†å·¥ã€‚",
                    "è¨ˆç®—æœªä¾†ä¸‰å¹´çš„é æœŸåˆ©æ½¤ã€‚"
                ],
                correctAnswerIndex: 2,
                feedback_correct: "ğŸ¯ å¤ªæ£’äº†ï¼åˆ¶å®šè¨ˆåŠƒçš„é—œéµæ˜¯å°‡ä»»å‹™è½å¯¦åˆ°äººã€æ™‚é–“å’Œæ–¹æ³•ä¸Šã€‚",
                feedback_incorrect: "ğŸ’¡ éŒ¯èª¤ï¼è¨ˆç•«éšæ®µçš„é‡é»æ˜¯ WBS (å·¥ä½œåˆ†è§£çµæ§‹) å’Œæ™‚ç¨‹ç®¡ç†ï¼Œç¢ºä¿æ¯å€‹ä»»å‹™éƒ½æœ‰è² è²¬äººã€æ™‚é–“è¡¨å’Œæ–¹æ³•ã€‚"
            }
        ];

        // =========================================================================
        // ç‹€æ…‹ç®¡ç†å’Œ DOM å¼•ç”¨
        // =========================================================================

        let domRefs = {}; // å„²å­˜æ‰€æœ‰ DOM å…ƒç´ çš„å¼•ç”¨
        let currentQuestions = []; // ç•¶å‰æ­£åœ¨é€²è¡Œçš„é¡Œç›®é›†
        let currentQuestionIndex = -1;
        let userScore = 0;
        let quizInProgress = false;
        let stepPerformance = {}; // è¿½è¹¤æ¯å€‹æ­¥é©Ÿçš„è¡¨ç¾ { "ä¸»é¡Œé¸å®š": { correct: 1, total: 1 } }
        let selectedQuizType = 'problem'; // å„²å­˜é¸æ“‡çš„æ¸¬é©—é¡å‹

        // =========================================================================
        // æ ¸å¿ƒé‚è¼¯å‡½æ•¸
        // =========================================================================

        /**
         * å•Ÿå‹•æ¸¬é©—
         * @param {string} type - æ¸¬é©—é¡å‹ ('problem' æˆ– 'solution')
         */
        function startQuiz(type) {
            selectedQuizType = type;
            currentQuestions = type === 'problem' ? PROBLEM_QUESTIONS : SOLUTION_QUESTIONS;
            
            // éš¨æ©Ÿæ‰“äº‚é¡Œç›®é †åº
            shuffleArray(currentQuestions); 

            currentQuestionIndex = 0;
            userScore = 0;
            quizInProgress = true;
            stepPerformance = {};

            domRefs.welcomeScreen.classList.add('hidden');
            domRefs.progressSection.classList.remove('hidden');
            domRefs.quizContainer.classList.remove('hidden');
            domRefs.mainActionBtn.textContent = 'è«‹é¸æ“‡ä¸€å€‹ç­”æ¡ˆ';
            domRefs.mainActionBtn.disabled = true; // å‰›é–‹å§‹æ™‚ç¦ç”¨æŒ‰éˆ•
            domRefs.mainTitle.innerHTML = type === 'problem' ? 
                'ğŸš¨ å•é¡Œè§£æ±ºå‹ QCC æŒ‘æˆ°' : 'ğŸ’¡ èª²é¡Œé”æˆå‹ QCC æŒ‘æˆ°';

            displayQuestion();
        }

        /**
         * é¡¯ç¤ºç•¶å‰é¡Œç›®
         */
        function displayQuestion() {
            const currentQuestion = currentQuestions[currentQuestionIndex];
            // æ›´æ–°é€²åº¦é¡¯ç¤º
            updateProgressDisplay();
            // æ›´æ–°é¡Œç›®
            // ç”±æ–¼é¡Œç›®å…§å®¹ç¾åœ¨å¯èƒ½åŒ…å« HTML æ¨™ç±¤ï¼Œæˆ‘å€‘ç›´æ¥ä½¿ç”¨ innerHTML
            domRefs.quizQuestion.innerHTML = `<span class="text-pink-500">[${currentQuestion.step}]</span> ${currentQuestion.question}`;
            // æ›´æ–°é¸é …
            domRefs.quizOptions.innerHTML = '';
            currentQuestion.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                // æ‡‰ç”¨å¤§å€å¡Šæ¨£å¼
                optionElement.className = `answer-option bg-white p-5 md:p-6 rounded-xl shadow-md hover:shadow-lg transition-all duration-300 border-purple-200 text-lg md:text-xl font-medium text-gray-700`;
                optionElement.innerHTML = `
                    
                    <!-- START: æ ¹æ“šç”¨æˆ¶éœ€æ±‚ä¿®æ”¹çš„åœˆåœˆæ¨£å¼ -->
                    <!-- ä½¿ç”¨ inline-flex å’Œ items-center/justify-center å¯¦ç¾å®Œç¾ç½®ä¸­ -->
                    <!-- ä½¿ç”¨ w-8 h-8 å¢å¤§åœˆåœˆå°ºå¯¸ -->
                    <span class="inline-flex items-center justify-center w-8 h-8 bg-purple-100 text-purple-700 rounded-full mr-3 border-2 border-purple-400 font-extrabold text-lg">${String.fromCharCode(65 + index)}</span>
                    <!-- END: æ ¹æ“šç”¨æˆ¶éœ€æ±‚ä¿®æ”¹çš„åœˆåœˆæ¨£å¼ -->
                    ${option}
                `;
                optionElement.dataset.index = index;
                
                
                // åŠ ä¸Šé»æ“Šäº‹ä»¶
                optionElement.addEventListener('click', () => selectAnswer(index, optionElement, currentQuestion));
                domRefs.quizOptions.appendChild(optionElement);
            });
            // ç¢ºä¿å›é¥‹å€å¡Šæ˜¯éš±è—çš„
            domRefs.quizFeedback.classList.add('hidden');
            // æ¸…é™¤ä¸Šæ¬¡çš„æŒ‰éˆ•ç‹€æ…‹ï¼Œé‡æ–°ç¶å®šé¸é …é»æ“Š
            domRefs.quizOptions.querySelectorAll('.answer-option').forEach(el => el.classList.remove('disabled'));
            
            // é‡æ–°å•Ÿç”¨ä¸»æŒ‰éˆ•ç”¨æ–¼ä¸‹ä¸€é¡Œæ“ä½œ (ä½†å¿…é ˆåœ¨ selectAnswer ä¸­ç¦ç”¨)
            domRefs.mainActionBtn.textContent = 'è«‹é¸æ“‡ä¸€å€‹ç­”æ¡ˆ';
            domRefs.mainActionBtn.disabled = true;
        }

        /**
         * è™•ç†ç”¨æˆ¶é»æ“Šç­”æ¡ˆçš„äº‹ä»¶
         * @param {number} selectedIndex - ç”¨æˆ¶é¸æ“‡çš„é¸é …ç´¢å¼•
         * @param {HTMLElement} selectedElement - ç”¨æˆ¶é»æ“Šçš„é¸é … DOM å…ƒç´ 
         * @param {object} questionData - ç•¶å‰å•é¡Œçš„è³‡æ–™
         */
        function selectAnswer(selectedIndex, selectedElement, questionData) {
            // åªæœ‰åœ¨æ¸¬é©—é€²è¡Œä¸­ä¸”æœªå›ç­”æ™‚æ‰å…è¨±é»æ“Š
            if (!quizInProgress || selectedElement.classList.contains('disabled')) return;

            const correct = selectedIndex === questionData.correctAnswerIndex;
            
            // 1. ç¦ç”¨æ‰€æœ‰é¸é …ï¼Œé˜²æ­¢é‡è¤‡é»æ“Š
            domRefs.quizOptions.querySelectorAll('.answer-option').forEach(el => {
                el.classList.add('disabled');
                // ç§»é™¤åŸæœ‰çš„ hover æ•ˆæœ
                el.classList.remove('hover:shadow-lg', 'hover:shadow-2xl');
                el.style.pointerEvents = 'none'; // å¾¹åº•ç¦ç”¨
            
            });

            // 2. è™•ç†åˆ†æ•¸å’Œè¿½è¹¤
            const stepName = questionData.step;
            // ç”±æ–¼æ¯ä¸€æ­¥é©Ÿåªæœ‰ä¸€å€‹é¡Œç›®ï¼Œç›´æ¥ç”¨ç¸½æ•¸ 1 ä¾†è¨ˆç®—
            if (stepPerformance[stepName] === undefined) {
                 stepPerformance[stepName] = { correct: 0, total: 1 };
            }

            // 3. çµ¦äºˆèª‡å¼µçš„è¦–è¦ºå›é¥‹
            let feedbackText = '';
            let feedbackClass = '';

            if (correct) {
                userScore++;
                stepPerformance[stepName].correct = 1; // ç­”å°åˆ†æ•¸ç‚º 1
                // åŠ ä¸Šæ­£ç¢ºç­”æ¡ˆçš„é–ƒçˆå‹•ç•«
                selectedElement.classList.add('correct-blink');
                feedbackText = `<span class="text-3xl mr-3">ğŸ‰</span> ${questionData.feedback_correct || "ğŸ¯ ç­”å°äº†ï¼ä½ çœŸæ˜¯å€‹ QCC å°å¤©æ‰ï¼"}`;
                feedbackClass = 'bg-green-50 text-green-700 border-green-500 shadow-green-200';
            } else {
                stepPerformance[stepName].correct = 0; // ç­”éŒ¯åˆ†æ•¸ç‚º 0
                // åŠ ä¸ŠéŒ¯èª¤ç­”æ¡ˆçš„æ™ƒå‹•å‹•ç•«
                selectedElement.classList.add('incorrect-shake');
                // æ¨™ç¤ºå‡ºæ­£ç¢ºç­”æ¡ˆ
                const correctElement = domRefs.quizOptions.querySelector(`[data-index="${questionData.correctAnswerIndex}"]`);
                if (correctElement) {
                    correctElement.classList.remove('bg-white', 'border-purple-200');
                    correctElement.classList.add('bg-green-200', 'border-green-500', 'shadow-inner');
                }

                feedbackText = `<span class="text-3xl mr-3">âŒ</span> ${questionData.feedback_incorrect ||
                    "ğŸ’¡ ç­”éŒ¯äº†ï¼æ²’é—œä¿‚ï¼Œçœ‹çœ‹æ­£ç¢ºç­”æ¡ˆæ˜¯å“ªä¸€å€‹ï¼"}`;
                feedbackClass = 'bg-red-50 text-red-700 border-red-500 shadow-red-200';
            }
            
            // 4. é¡¯ç¤ºå›é¥‹å€å¡Š
            domRefs.quizFeedback.className = `mt-6 p-4 text-center rounded-xl font-bold transition-all duration-300 transform scale-100 border-2 ${feedbackClass}`;
            domRefs.quizFeedback.innerHTML = feedbackText;
            domRefs.quizFeedback.classList.remove('hidden');

            // 5. å•Ÿç”¨ä¸»è¦æŒ‰éˆ•ï¼Œè®“ç”¨æˆ¶æ‰‹å‹•é»æ“Šä¸‹ä¸€é¡Œ
            domRefs.mainActionBtn.textContent = (currentQuestionIndex < currentQuestions.length - 1) ?
                'ç¹¼çºŒä¸‹ä¸€é¡Œ' : 'æŸ¥çœ‹æœ€çµ‚æˆæœï¼';
            domRefs.mainActionBtn.disabled = false;
        }

        /**
         * è™•ç†ä¸»è¦å‹•ä½œæŒ‰éˆ•é»æ“Š (é€²å…¥ä¸‹ä¸€é¡Œæˆ–é¡¯ç¤ºçµæœ)
         */
        function handleMainAction() {
            if (currentQuestionIndex < currentQuestions.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                domRefs.mainActionBtn.disabled = true; // é€²å…¥ä¸‹ä¸€é¡Œå¾Œé‡æ–°ç¦ç”¨
            } else {
                showResults();
            }
        }

        /**
         * æ›´æ–°é€²åº¦æ¢å’Œæ–‡å­—é¡¯ç¤º
         */
        function updateProgressDisplay() {
            const total = currentQuestions.length;
            const current = currentQuestionIndex + 1;
            const percentage = (current / total) * 100;
            domRefs.progressDisplay.textContent = `ç¬¬ ${current} é¡Œ / å…± ${total} é¡Œ | ç›®å‰å¾—åˆ†: ${userScore} åˆ†`;
            domRefs.progressBar.style.width = `${percentage}%`;
        }

        /**
         * é¡¯ç¤ºæœ€çµ‚çµæœå’Œåˆ†æ
         */
        function showResults() {
            quizInProgress = false;
            domRefs.quizContainer.classList.add('hidden');
            domRefs.progressSection.classList.add('hidden'); // éš±è—é€²åº¦æ¢
            domRefs.resultContainer.classList.remove('hidden');
            
            const totalQuestions = currentQuestions.length;
            const percentage = Math.round((userScore / totalQuestions) * 100);

            let resultTitle = '';
            let resultClass = '';
            let resultText = '';
            // æ ¹æ“šé¸æ“‡çš„é¡å‹å¾®èª¿çµæœæè¿°
            const typeLabel = selectedQuizType === 'problem' ?
                'å•é¡Œè§£æ±ºå‹' : 'èª²é¡Œé”æˆå‹';
            const stepData = selectedQuizType === 'problem' ? PROBLEM_STEPS_DATA : SOLUTION_STEPS_DATA;
            if (percentage >= 90) {
                resultTitle = 'ğŸ‰ å‚³å¥‡å¤§å¸«ç´šï¼';
                resultText = `ä½ åœ¨ ${typeLabel} é ˜åŸŸçš„ QCC çŸ¥è­˜å·²é”é ‚å°–æ°´å¹³ï¼æ‰€æœ‰æ­¥é©Ÿéƒ½æŒæ¡å¾—éå¸¸ç´®å¯¦ï¼Œå¯ä»¥æ“”ä»»å°å¸«äº†ï¼`;
                resultClass = 'text-green-700 border-green-500 bg-green-100';
            } else if (percentage >= 70) {
                resultTitle = 'ğŸ‘ å„ªç§€å¯¦å‹™å®¶ï¼';
                resultText = `è¡¨ç¾éå¸¸æ£’ï¼ä½ å° ${typeLabel} çš„æ ¸å¿ƒæ­¥é©Ÿæœ‰å¾ˆå¥½çš„ç†è§£ï¼Œåªéœ€è¦åœ¨ç´°ç¯€è™•å†åŠ å¼·å°±èƒ½æ›´å®Œç¾ã€‚`;
                resultClass = 'text-blue-700 border-blue-500 bg-blue-100';
            } else if (percentage >= 50) {
                resultTitle = 'ğŸ§ ç©©å¥å­¸ç¿’ä¸­ï¼';
                resultText = `ä½ å·²ç¶“æŒæ¡äº† ${typeLabel} å¤§éƒ¨åˆ†çŸ¥è­˜ï¼Œä½†é‚„æœ‰ä¸€äº›æ­¥é©Ÿéœ€è¦å›é ­è¤‡ç¿’ã€‚ç¹¼çºŒåŠªåŠ›ï¼`;
                resultClass = 'text-yellow-700 border-yellow-500 bg-yellow-100';
            } else {
                resultTitle = 'ğŸš€ æŒ‘æˆ°è€…æ¨¡å¼ï¼';
                resultText = `æ²’é—œä¿‚ï¼Œé€™åªæ˜¯é–‹å§‹ï¼é€éé€™æ¬¡ ${typeLabel} æ¸¬é©—ï¼Œä½ çŸ¥é“è©²å¾ ${typeLabel} çš„å“ªå€‹æ­¥é©Ÿè£œå¼·äº†ï¼`;
                resultClass = 'text-red-700 border-red-500 bg-red-100';
            }

            // å¼±é»åˆ†æ HTML
            let analysisHTML = `
                <h3 class="text-2xl font-bold text-gray-700 mt-8 mb-4 border-b-2 border-dashed pb-2">ğŸ§  çŸ¥è­˜å¼±é»åˆ†æ (${typeLabel})</h3>
                <p class="text-gray-600 mb-4">æ ¹æ“šä½ çš„ä½œç­”ï¼Œæˆ‘å€‘ç‚ºä½ åˆ†æäº†åœ¨ QCC ä¹å¤§æ­¥é©Ÿä¸­ï¼Œå“ªå€‹ç’°ç¯€å¯èƒ½éœ€è¦åŠ å¼·ï¼š</p>
                <ul class="space-y-3">
            
                `;

            // ç¢ºä¿æŒ‰é †åºé¡¯ç¤º 9 å€‹æ­¥é©Ÿçš„è¡¨ç¾ï¼Œä¸¦å¾ stepData ä¸­ç²å–æ­¥é©Ÿåç¨±
            stepData.forEach(step => {
                const stepName = step.name;
                
                // å¾ stepPerformance ä¸­å–å‡ºè¿½è¹¤çš„æ•¸æ“š
                const performance = stepPerformance[stepName] || { 
                    correct: 0, total: 0 };
                
                // ç”±æ–¼æ˜¯å–®ä¸€é¡Œç›®çš„æ¸¬é©—æ¨¡å¼ï¼Œtotal æ‡‰è©²æ˜¯ 1 (å¦‚æœè©²æ­¥é©Ÿæœ‰é¡Œç›®)
                const totalInStep = performance.total > 0 ? performance.total : 1; 
                const hasQuestion = performance.total > 0;
                
                if (hasQuestion) {
    
                    const accuracy = (performance.correct / totalInStep) * 100;
                    let icon = 'ğŸŸ¢';
                    let textClass = 'text-green-600';
                    let recommendation = 'æŒæ¡å¾—å¾ˆå¥½ï¼';
                    
                    if (accuracy < 50) {
                        icon = 'ğŸ”´';
                        textClass = 'text-red-600 font-bold';
                        recommendation = 'âš ï¸ åš´é‡è½å¾Œï¼è«‹å‹™å¿…åŠ å¼·è¤‡ç¿’ã€‚';
                    } else if (accuracy < 100) { 
                        icon = 'ğŸŸ¡';
                        textClass = 'text-yellow-600';
                        recommendation = 'é‚„ä¸éŒ¯ï¼Œä½†ä»æœ‰é€²æ­¥ç©ºé–“ã€‚';
                    }

                    analysisHTML += `
                        <li class="p-4 bg-gray-50 rounded-lg shadow-sm border-l-4 border-purple-400">
                            <div class="flex items-center justify-between">
                                <span class="font-semibold text-gray-800">${step.id}. ${stepName}</span>
                                <span class="${textClass} text-lg">${performance.correct} / ${totalInStep} é¡Œ (${accuracy.toFixed(0)}%)</span>
                            </div>
                            <p class="text-sm mt-1 text-gray-500">${recommendation}</p>
                        </li>
                    `;
                }
            });

            analysisHTML += `</ul>`;
            domRefs.resultContainer.innerHTML = `
                <!-- æ›´æ”¹: å¢å¤§çµæœæ¨™é¡Œå­—é«”è‡³ md:text-4xl -->
                <h2 class="text-4xl md:text-4xl font-extrabold text-center mb-4 ${resultClass}">${resultTitle}</h2>
                <!-- æ›´æ”¹: å¢å¤§ç¸½å¾—åˆ†å­—é«”è‡³ md:text-2xl -->
                <p class="text-center text-xl md:text-2xl text-gray-600 mb-6">ç¸½å¾—åˆ†ï¼š<span class="font-extrabold text-pink-600">${userScore} / ${totalQuestions}</span> é¡Œ</p>
                <!-- ğŸ¯ é€™è£¡ä¿®æ”¹äº†å­—é«”å¤§å°ï¼šå°‡ md:text-2xl æ”¹ç‚º md:text-xl -->
                <div class="p-4 rounded-xl ${resultClass} text-center font-semibold text-xl md:text-xl border-2">
                    ${resultText}
                
                </div>
                
                ${analysisHTML} <!-- æ³¨å…¥å¼±é»åˆ†æå€å¡Š -->
                
                <button id="restartQuizBtn" class="fun-action-btn w-full mt-8 py-4 text-2xl font-bold rounded-xl shadow-lg hover:shadow-2xl">
                    
                    å†ä¾†ä¸€è¼ªæŒ‘æˆ°ï¼
                </button>
            `;
            // é‡æ–°é–‹å§‹åŠŸèƒ½ï¼šç¶å®šåˆ°æ–°çš„æŒ‰éˆ•ä¸Š
            document.getElementById('restartQuizBtn').addEventListener('click', initializeQuiz);
            // ç¢ºä¿ä¸»æŒ‰éˆ•è¢«ç§»é™¤äº‹ä»¶ä¸¦ä¿æŒéš±è—
            domRefs.mainActionBtn.removeEventListener('click', handleMainAction);
        }
        
        // éš¨æ©Ÿæ‰“äº‚æ•¸çµ„
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        /**
         * åˆå§‹åŒ–æ¸¬é©—ç‹€æ…‹å’Œ UI (ç¾åœ¨æ˜¯é¡å‹é¸æ“‡ç•«é¢)
         */
        function initializeQuiz() {
            // 1. ç²å–æ‰€æœ‰ DOM å…ƒç´ ä¸¦å„²å­˜åˆ° domRefs
            domRefs.mainTitle = document.getElementById('mainTitle');
            domRefs.welcomeScreen = document.getElementById('welcomeScreen');
            domRefs.progressSection = document.getElementById('progressSection');
            domRefs.quizContainer = document.getElementById('quizContainer');
            domRefs.quizQuestion = document.getElementById('quizQuestion');
            domRefs.quizOptions = document.getElementById('quizOptions');
            domRefs.quizFeedback = document.getElementById('quizFeedback');
            domRefs.mainActionBtn = document.getElementById('mainActionBtn');
            domRefs.progressDisplay = document.getElementById('progressDisplay');
            domRefs.progressBar = document.getElementById('progressBar');
            domRefs.resultContainer = document.getElementById('resultContainer');

            const selectProblemType = document.getElementById('selectProblemType'); 
            const selectSolutionType = document.getElementById('selectSolutionType');

            // 2. é‡ç½®ç‹€æ…‹è®Šæ•¸
            currentQuestionIndex = -1;
            userScore = 0;
            quizInProgress = false;
            stepPerformance = {}; 
            selectedQuizType = 'problem'; 
            currentQuestions = []; 

            // 3. é‡ç½® UI é¡¯ç¤º
            domRefs.mainTitle.innerHTML = 'ğŸ› ï¸ QCC çŸ¥è­˜é»é»å ğŸ¯';
            domRefs.welcomeScreen.classList.remove('hidden');
            domRefs.progressSection.classList.add('hidden');
            domRefs.quizContainer.classList.add('hidden');
            domRefs.resultContainer.classList.add('hidden');

            // 4. ç¶å®šé¡å‹é¸æ“‡æŒ‰éˆ•äº‹ä»¶
            if (selectProblemType && selectSolutionType) {
                // å…ˆç§»é™¤èˆŠçš„ï¼Œå†ç¶å®šæ–°çš„ (é˜²æ­¢é‡è¤‡ç¶å®š)
                selectProblemType.onclick = null; 
                selectSolutionType.onclick = null;
                selectProblemType.onclick = () => startQuiz('problem');
                selectSolutionType.onclick = () => startQuiz('solution');
            }
            
            // 5. ç¶å®šä¸»è¦å‹•ä½œæŒ‰éˆ• (in-quiz flow)
            // ç¢ºä¿æ¯æ¬¡é‡ç½®éƒ½èƒ½æ­£ç¢ºç¶å®šåˆ° handleMainAction
            domRefs.mainActionBtn.removeEventListener('click', handleMainAction);
            domRefs.mainActionBtn.addEventListener('click', handleMainAction);
        }

        // é é¢è¼‰å…¥æ™‚åŸ·è¡Œåˆå§‹åŒ–
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeQuiz);
        } else {
            initializeQuiz();
        }

    </script>
</body>
</html>
