<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QCC çŸ¥è­˜æŒ‘æˆ°ï¼šè¶£å‘³ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ä½¿ç”¨ Noto Sans TC ç¢ºä¿ä¸­æ–‡é¡¯ç¤ºç¾è§€ä¸”è¦ªåˆ‡ -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@500;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f7f3f9; /* æŸ”å’ŒèƒŒæ™¯è‰² */
        }

        /* éŠæˆ²åŒ–å€å¡Šå®¹å™¨æ¨£å¼ */
        .quiz-card {
            background: linear-gradient(135deg, #ffffff 0%, #fef3c7 100%);
            border-radius: 2rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15), 0 0 0 8px #f5d0fe; /* èª‡å¼µé‚Šæ¡†/é™°å½± */
        }

        /* QCC Type Selection Button Style (æ–°æ¨£å¼) */
        .quiz-type-btn {
            color: white;
            padding: 2.5rem 2rem;
            border-radius: 1.5rem;
            font-weight: 700;
            font-size: 1.75rem; /* 28px */
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
            flex-grow: 1;
            transition: transform 0.2s, box-shadow 0.2s;
            border: 4px solid white;
        }
        .quiz-type-btn:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.3);
        }
        .quiz-type-btn:active {
            transform: translateY(-2px) scale(0.99);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        /* é¸é …å€å¡Šçš„åŸºç¤æ¨£å¼ï¼Œç¢ºä¿é»æ“Šç¯„åœå¤ å¤§ */
        .answer-option {
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* å½ˆæ€§éæ¸¡æ•ˆæœ */
            border-width: 3px;
            cursor: pointer;
        }

        /* é¸é … Hover æ•ˆæœï¼šè¼•å¾®æŠ¬å‡ */
        .answer-option:hover:not(.disabled):not(.correct-blink):not(.incorrect-shake) {
            transform: translateY(-4px);
            box-shadow: 0 6px 15px rgba(139, 92, 246, 0.3);
            border-color: #a78bfa;
        }

        /* æ­£ç¢ºç­”æ¡ˆé–ƒçˆå‹•ç•« */
        @keyframes correctBlink {
            0%, 100% { background-color: #6ee7b7; border-color: #059669; transform: scale(1.05); }
            50% { background-color: #d1fae5; border-color: #10b981; transform: scale(1); }
        }
        .correct-blink {
            animation: correctBlink 0.5s ease-in-out 3;
            pointer-events: none; /* ç¦ç”¨é»æ“Š */
        }

        /* éŒ¯èª¤ç­”æ¡ˆæ™ƒå‹•å‹•ç•« */
        @keyframes incorrectShake {
            0%, 100% { transform: translateX(0); background-color: #fca5a5; border-color: #dc2626; }
            20%, 60% { transform: translateX(-8px); }
            40%, 80% { transform: translateX(8px); }
        }
        .incorrect-shake {
            animation: incorrectShake 0.4s ease-in-out;
            pointer-events: none; /* ç¦ç”¨é»æ“Š */
            filter: grayscale(80%); /* éŒ¯èª¤é¸é …è®Šç° */
        }

        /* ä¸»è¦æŒ‰éˆ•çš„è¶£å‘³æ¨£å¼ */
        .fun-action-btn {
            background-image: linear-gradient(to right, #8b5cf6 0%, #ec4899 100%);
            color: white;
            transition: all 0.2s;
        }
        .fun-action-btn:hover:not(:disabled) {
            transform: scale(1.02);
            box-shadow: 0 10px 20px rgba(139, 92, 246, 0.4);
            filter: brightness(1.1);
        }
        .fun-action-btn:active:not(:disabled) {
            transform: scale(0.98);
        }
        .fun-action-btn:disabled {
            background-image: linear-gradient(to right, #d1d5db 0%, #9ca3af 100%);
            cursor: not-allowed;
        }
       #quizFeedback {
           font-size: 1.8rem; /* å¯è‡ªè¡Œèª¿æ•´ 1.5remï½2.5rem */
           line-height: 1.6;
       }

    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div id="app" class="w-full max-w-4xl p-6 md:p-10 quiz-card">
        
        <h1 id="mainTitle" class="text-4xl md:text-5xl font-extrabold text-purple-700 text-center mb-6">
            ğŸ› ï¸ QCC çŸ¥è­˜é»é»å ğŸ¯
        </h1>
        <p class="text-center text-xl text-gray-600 mb-8 font-semibold">
            è®“æˆ‘å€‘ç”¨æœ‰è¶£çš„æ–¹å¼ï¼ŒæŒ‘æˆ° QCC å•é¡Œè§£æ±ºçš„çŸ¥è­˜æ ¸å¿ƒå§ï¼
        </p>

        <!-- æ­¡è¿ç•«é¢/é¡å‹é¸æ“‡ -->
        <div id="welcomeScreen" class="p-8 md:p-12 bg-white rounded-2xl shadow-xl border-4 border-purple-500 text-center">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">ğŸ† è«‹é¸æ“‡ä½ çš„æŒ‘æˆ°é¡å‹ ğŸ†</h2>
            
            <div id="typeSelector" class="flex flex-col md:flex-row gap-6 mb-8">
                <!-- å•é¡Œè§£æ±ºå‹æŒ‰éˆ• -->
                <button id="selectProblemType" data-type="problem" class="quiz-type-btn bg-pink-500 hover:bg-pink-600 focus:ring-4 focus:ring-pink-300">
                    å•é¡Œè§£æ±ºå‹
                    <p class="text-lg font-normal mt-1 opacity-90">é‡å°å“è³ªç•°å¸¸æˆ–åå·®é€²è¡Œæ”¹å–„</p>
                </button>
                <!-- èª²é¡Œé”æˆå‹æŒ‰éˆ• -->
                <button id="selectSolutionType" data-type="solution" class="quiz-type-btn bg-teal-500 hover:bg-teal-600 focus:ring-4 focus:ring-teal-300">
                    èª²é¡Œé”æˆå‹
                    <p class="text-lg font-normal mt-1 opacity-90">é‡å°ç›®æ¨™é”æˆæˆ–æ–°èª²é¡Œæ¨é€²</p>
                </button>
            </div>


            <!-- è¦å‰‡èªªæ˜ -->
            <div id="quizRules" class="mt-8 text-left border-t pt-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-3">ğŸ“‹ æŒ‘æˆ°è¦å‰‡</h3>
                <ul class="text-left text-lg text-gray-700 space-y-3 list-none pl-0">
                    <li class="flex items-center"><span class="text-pink-500 text-2xl mr-3">ğŸ’¡</span> å…±æœ‰ 9 é¡Œéš¨æ©Ÿå•é¡Œï¼Œæ¶µè“‹ä½ é¸æ“‡çš„ QCC ä¹å¤§æ­¥é©Ÿã€‚</li>
                    <li class="flex items-center"><span class="text-pink-500 text-2xl mr-3">ğŸš€</span> é»æ“Šç­”æ¡ˆå¾Œï¼Œç«‹å³æœƒé¡¯ç¤ºæœ‰è¶£çš„è¦–è¦ºå’Œæ–‡å­—å›é¥‹ã€‚</li>
                    <li class="flex items-center"><span class="text-pink-500 text-2xl mr-3">âœ…</span> ç­”å°è¨ˆåˆ†ï¼ç­”éŒ¯æœƒæ–æ™ƒä¸¦æ¨™ç¤ºæ­£ç¢ºç­”æ¡ˆã€‚</li>
                    <li class="flex items-center"><span class="text-pink-500 text-2xl mr-3">ğŸ“ˆ</span> å®Œæˆå¾Œå°‡åˆ†æä½ åœ¨å“ªå€‹æ­¥é©Ÿçš„çŸ¥è­˜æœ€éœ€è¦è£œå¼·ã€‚</li>
                </ul>
            </div>
        </div>


        <!-- é€²åº¦æ¢ (é è¨­éš±è—) -->
        <div id="progressSection" class="mb-8 hidden">
            <div id="progressDisplay" class="text-lg font-bold text-pink-600 mb-2 text-center">
                æº–å‚™é–‹å§‹...
            </div>
            <div class="w-full bg-gray-200 rounded-full h-3">
                <div id="progressBar" class="bg-gradient-to-r from-purple-400 to-pink-500 h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>
        </div>
        
        <!-- æ¸¬é©—å•é¡Œèˆ‡é¸é …å®¹å™¨ (é è¨­éš±è—) -->
        <div id="quizContainer" class="hidden p-6 md:p-8 bg-white rounded-2xl shadow-xl border-4 border-purple-300">
            <div id="questionContainer" class="mb-6">
                <p id="quizQuestion" class="text-2xl md:text-3xl font-extrabold text-gray-800 leading-snug mb-6 text-center">
                    é¡Œç›®å…§å®¹å°‡æœƒé¡¯ç¤ºåœ¨é€™è£¡ã€‚
                </p>
                <div id="quizOptions" class="space-y-4">
                    <!-- é¸é …å°‡æœƒé€é JS æ³¨å…¥ -->
                </div>
            </div>

            <!-- å³æ™‚å›é¥‹å€å¡Š -->
            <div id="quizFeedback" class="hidden mt-6 p-4 text-center rounded-xl font-bold transition-all duration-300 transform scale-100 border-2">
                <!-- å›é¥‹å…§å®¹å°‡æœƒé€é JS æ³¨å…¥ -->
            </div>
            
            <!-- ä¸»è¦å‹•ä½œæŒ‰éˆ•ï¼šä¸‹ä¸€é¡Œ/æŸ¥çœ‹çµæœ -->
            <button id="mainActionBtn" class="fun-action-btn w-full mt-8 py-4 text-2xl font-bold rounded-xl shadow-lg hover:shadow-2xl">
                é€²è¡Œä¸‹ä¸€é¡Œ
            </button>
        </div>

        <!-- çµæœå±•ç¤ºå€å¡Š -->
        <div id="resultContainer" class="hidden mt-10 p-6 md:p-8 bg-white rounded-2xl shadow-xl border-4 border-pink-400">
            <!-- çµæœå°‡æœƒé€é JS æ³¨å…¥ -->
        </div>

    </div>

    <script type="module">
        // æ¸¬é©—æ•¸æ“šçµæ§‹ï¼šåŒ…å«å…©ç¨® QCC æ¨¡å¼çš„ 9 å¤§æ­¥é©Ÿ
        const PROBLEM_STEPS_DATA = [
            // âœ… å•é¡Œè§£æ±ºå‹æ­¥é©Ÿ (å•é¡Œè§£æ±ºå‹)
            { id: 1, name: "é¸å®šä¸»é¡Œ", quiz: [{ question: "QCC é¸æ“‡ã€å•é¡Œè§£æ±ºå‹ã€ä¸»é¡Œæ™‚ï¼Œé¦–è¦è€ƒæ…®çš„å› ç´ æ˜¯ï¼Ÿ", options: ["æ˜¯å¦èˆ‡è‡ªèº«æ¥­å‹™ç›¸é—œä¸”èƒ½ç”¢ç”Ÿå¯¦è³ªæ•ˆç›Šã€‚", "æ˜¯å¦ç‚ºç®¡ç†å±¤æŒ‡å®šçš„èª²é¡Œã€‚", "æ˜¯å¦å®¹æ˜“åœ¨å…©é€±å…§å®Œæˆã€‚", "æ˜¯å¦ç‚ºæˆå“¡æœ€æœ‰èˆˆè¶£çš„ä¼‘é–’è©±é¡Œã€‚"], correctAnswerIndex: 0, step: "é¸å®šä¸»é¡Œ", feedback_correct: "ğŸ¯ å®Œç¾å‘½ä¸­ï¼ä¸»é¡Œè¦è·Ÿå·¥ä½œæ•ˆç›Šé€£çµï¼Œæ˜¯å•é¡Œè§£æ±ºçš„æ ¹æœ¬ã€‚", feedback_incorrect: "ğŸ¤” ç­”éŒ¯å›‰ï¼å•é¡Œè§£æ±ºå‹çš„æ ¸å¿ƒæ˜¯æ‰¾å‡ºèƒ½ç‚ºçµ„ç¹”å¸¶ä¾†æ•ˆç›Šçš„å¯¦éš›å•é¡Œï¼" }] },
            { id: 2, name: "ç¾ç‹€æŠŠæ¡", quiz: [{ question: "ã€ç¾ç‹€æŠŠæ¡ã€æœ€ä¸»è¦çš„ç›®æ¨™æ˜¯é€éæ•¸æ“šä¾†å®Œæˆä»€éº¼ï¼Ÿ", options: ["è¨­å®šæ˜ç¢ºçš„ç›®æ¨™å€¼ã€‚", "æ‰¾å‡ºæ‰€æœ‰å¯èƒ½çš„åŸå› ã€‚", "å°‡å•é¡Œåˆ†å±¤ã€é‡åŒ–ï¼Œä¸¦æ‰¾å‡ºå½±éŸ¿å…¶åˆ†ä½ˆçš„è¦å› ã€‚", "æå‡ºè§£æ±ºæ–¹æ¡ˆä¸¦é€²è¡Œé ç®—è©•ä¼°ã€‚"], correctAnswerIndex: 2, step: "ç¾ç‹€æŠŠæ¡", feedback_correct: "âœ… æ­£ç¢ºï¼æ•¸æ“šåŒ–ã€åˆ†å±¤åŒ–æ˜¯ç¾ç‹€æŠŠæ¡ï¼Œç‚ºå¾ŒçºŒåˆ†ææ‰“åŸºç¤ã€‚", feedback_incorrect: "ğŸ” æ¥è¿‘äº†ï¼ç¾ç‹€æŠŠæ¡æ˜¯å°ˆæ³¨åœ¨ã€æ”¶é›†æ•¸æ“šã€å’Œã€åˆ†å±¤ã€ï¼Œé‚„ä¸åˆ°ã€æ‰¾åŸå› ã€éšæ®µã€‚" }] },
            { id: 3, name: "ç›®æ¨™è¨­å®š", quiz: [{ question: "å•é¡Œè§£æ±ºå‹ QCC è¨­å®šæ”¹å–„ç›®æ¨™æ™‚ï¼Œé€šå¸¸æœƒä»¥å“ªç¨®å½¢å¼è¡¨é”ï¼Ÿ", options: ["ä¸€å€‹æ¨¡ç³Šçš„é¡˜æ™¯æ•˜è¿°ã€‚", "ç›®æ¨™æ‡‰å…·å‚™ S.M.A.R.T. ç‰¹æ€§ï¼Œä¸”å…·æŒ‘æˆ°æ€§ã€‚", "ç›®æ¨™å¿…é ˆæ˜¯ç™¾åˆ†ä¹‹ç™¾é”æˆï¼Œå¦å‰‡è¦–ç‚ºå¤±æ•—ã€‚", "ç›®æ¨™æ‡‰è¨­å®šç‚ºç›®å‰èƒ½åŠ›çš„ 50% ä»¥å…§ã€‚"], correctAnswerIndex: 1, step: "ç›®æ¨™è¨­å®š", feedback_correct: "ğŸŒŸ å°±æ˜¯é€™å€‹ï¼S.M.A.R.T. åŸå‰‡ç¢ºä¿ç›®æ¨™å…·é«”å¯è¡¡é‡ã€‚", feedback_incorrect: "âŒ S.M.A.R.T. åŸå‰‡æ‰æ˜¯é‡é»ï¼Œç›®æ¨™è¦æœ‰æŒ‘æˆ°æ€§ï¼Œä½†ä¹Ÿè¦èƒ½è¡¡é‡å–”ï¼" }] },
            { id: 4, name: "åŸå› åˆ†æ", quiz: [{ question: "åœ¨ã€åŸå› åˆ†æã€éšæ®µï¼Œæœ€å¸¸ç”¨ä¾†å¾ç¾è±¡è¿½æº¯åˆ°æ ¹æœ¬åŸå› çš„å·¥å…·æ˜¯ï¼Ÿ", options: ["æŸæ‹‰åœ– (Pareto Chart)ã€‚", "ç”˜ç‰¹åœ– (Gantt Chart)ã€‚", "é­šéª¨åœ– (ç‰¹æ€§è¦å› åœ–) èˆ‡ 5 Why åˆ†ææ³•ã€‚", "æ§åˆ¶åœ– (Control Chart)ã€‚"], correctAnswerIndex: 2, step: "åŸå› åˆ†æ", feedback_correct: "ğŸ’¡ è°æ˜ï¼é­šéª¨åœ–æ‰¾æ‰€æœ‰å¯èƒ½åŸå› ï¼Œ5 Why å¾€ä¸‹æ·±æŒ–æ ¹æœ¬åŸå› ã€‚", feedback_incorrect: "ğŸ˜µâ€ å–”å–”ï¼åŸå› åˆ†æå°±æ˜¯è¦æ‰¾åˆ°ã€æ ¹æœ¬åŸå› ã€ï¼Œé­šéª¨åœ–å’Œ 5 Why çµ„åˆæ˜¯ç‹é“ï¼" }] },
            { id: 5, name: "å°ç­–æ“¬å®š", quiz: [{ question: "æ“¬å®šå°ç­–æ™‚ï¼Œé™¤äº†è€ƒæ…®æ•ˆæœï¼Œé‚„å¿…é ˆè©•ä¼°å“ªä¸‰é …é—œéµå› ç´ ï¼Ÿ", options: ["æ”¿æ²»ã€ç¤¾æœƒèˆ‡æ³•å¾‹é¢¨éšªã€‚", "å°ç­–çš„è²»ç”¨ã€å¯è¡Œæ€§èˆ‡å‰¯ä½œç”¨ã€‚", "å“¡å·¥èˆˆè¶£ã€ä¸»ç®¡åå¥½èˆ‡è¼¿è«–ã€‚", "ç«¶çˆ­å°æ‰‹çš„åæ‡‰èˆ‡å¸‚å ´è¶¨å‹¢ã€‚"], correctAnswerIndex: 1, step: "å°ç­–æ“¬å®š", feedback_correct: "ğŸ‘ æ²’éŒ¯ï¼è²»ç”¨ã€å¯è¡Œæ€§ã€å‰¯ä½œç”¨æ˜¯å¯¦æ–½å‰å¿…é ˆè€ƒæ…®çš„ã€é¢¨éšªã€ã€‚", feedback_incorrect: "ğŸš§ å°å¿ƒï¼åœ¨å¯¦æ–½å‰ï¼Œè¦å…ˆç¢ºèªé€™å€‹å°ç­–ã€èƒ½ä¸èƒ½åšã€ï¼Œã€æœƒä¸æœƒå‡ºå•é¡Œã€ã€‚" }] },
            { id: 6, name: "å°ç­–å¯¦æ–½", quiz: [{ question: "ç‚ºäº†ç¢ºä¿ã€å°ç­–å¯¦æ–½ã€èƒ½æŒ‰æ™‚å®Œæˆï¼Œæœ€å¸¸ä½¿ç”¨çš„ç®¡ç†å·¥å…·æ˜¯ï¼Ÿ", options: ["æŸæ‹‰åœ–ã€‚", "æŸ¥æª¢è¡¨ (Check Sheet)ã€‚", "æµç¨‹åœ– (Flow Chart)ã€‚", "ç”˜ç‰¹åœ–æˆ–å¯¦æ–½é€²åº¦è¡¨ã€‚"], correctAnswerIndex: 3, step: "å°ç­–å¯¦æ–½", feedback_correct: "ğŸ“… æ­£ç¢ºï¼é€²åº¦è¡¨æˆ–ç”˜ç‰¹åœ–æ˜¯è¿½è¹¤æ™‚é–“èˆ‡é€²åº¦çš„æ¨™æº–å·¥å…·ã€‚", feedback_incorrect: "âŒ ç­”éŒ¯äº†ï¼è¿½è¹¤é€²åº¦è¦é ç”˜ç‰¹åœ–é€™é¡æ™‚é–“ç®¡ç†å·¥å…·å–”ï¼" }] },
            { id: 7, name: "æ•ˆæœç¢ºèª", quiz: [{ question: "ã€æ•ˆæœç¢ºèªã€ä¸»è¦ç¢ºèªå“ªå…©ç¨®æ•ˆæœï¼Ÿ", options: ["å³æ™‚æ•ˆæœèˆ‡é•·æœŸæ•ˆæœã€‚", "ç›´æ¥æ•ˆæœèˆ‡é–“æ¥æ•ˆæœã€‚", "æœ‰å½¢æ•ˆæœ (æ•¸æ“š) èˆ‡ç„¡å½¢æ•ˆæœ (è»Ÿæ€§)ã€‚", "åœ˜éšŠå£«æ°£æ•ˆæœèˆ‡ä¸»ç®¡æ»¿æ„åº¦ã€‚"], correctAnswerIndex: 2, step: "æ•ˆæœç¢ºèª", feedback_correct: "ğŸ’° å°ˆæ¥­ï¼æ•¸æ“šä¸Šçš„ã€æœ‰å½¢æ•ˆæœã€å’Œé›£ä»¥é‡åŒ–çš„ã€ç„¡å½¢æ•ˆæœã€éƒ½ä¸å¯å°‘ã€‚", feedback_incorrect: "ğŸ‘€ ç­”éŒ¯äº†ï¼QCC ç‰¹åˆ¥å¼·èª¿å€åˆ†ã€æœ‰å½¢ã€(æ•¸æ“š)å’Œã€ç„¡å½¢ã€(è»Ÿæ€§)æ•ˆæœã€‚" }] },
            { id: 8, name: "æ¨™æº–åŒ–èˆ‡ç¶­æŒ", quiz: [{ question: "ã€æ¨™æº–åŒ–èˆ‡ç¶­æŒã€çš„æ ¸å¿ƒç›®çš„æ˜¯ä»€éº¼ï¼Ÿ", options: ["èˆ‰è¡Œæ…¶åŠŸå®´æ„Ÿè¬æ‰€æœ‰æˆå“¡ã€‚", "å°‡æˆåŠŸçš„åšæ³•å¯«å…¥ä½œæ¥­æŒ‡å°æ›¸ (SOP) æˆ–ä¿®è¨‚æµç¨‹ã€‚", "é‡æ–°é¸å®šæ–°çš„æ”¹å–„ä¸»é¡Œã€‚", "è¨ˆç®—æ”¹å–„å¸¶ä¾†çš„ç¸½é«”ç¶“æ¿Ÿæ•ˆç›Šã€‚"], correctAnswerIndex: 1, step: "æ¨™æº–åŒ–èˆ‡ç¶­æŒ", feedback_correct: "ğŸ‘‘ æ²’éŒ¯ï¼æ¨™æº–åŒ–å°±æ˜¯å°‡æˆåŠŸçš„åšæ³•å¯«å…¥åˆ¶åº¦ï¼Œç¢ºä¿æ•ˆæœèƒ½æŒçºŒã€‚", feedback_incorrect: "ğŸ”’ æ¨™æº–åŒ–ä¸æ˜¯çµæŸï¼Œè€Œæ˜¯ã€ç¶­æŒã€ï¼æ ¸å¿ƒæ˜¯ä¿®è¨‚æµç¨‹æ–‡ä»¶ï¼Œé˜²æ­¢å†ç™¼ã€‚" }] },
            { id: 9, name: "æª¢è¨èˆ‡ä¸‹ä¸€æ­¥", quiz: [{ question: "åœ¨å•é¡Œè§£æ±ºå‹ QCC çš„ã€æª¢è¨èˆ‡ä¸‹ä¸€æ­¥ã€éšæ®µï¼Œæœ€é‡è¦çš„æ˜¯ä»€éº¼ï¼Ÿ", options: ["è¦åŠƒä¸‹ä¸€å€‹ä¸»é¡Œçš„é ç®—ã€‚", "ç¸½çµæœ¬æ¬¡æ´»å‹•ï¼Œä¸¦æå‡ºå¾ŒçºŒæ¨å»£æˆ–æ”¹å–„çš„æ–¹å‘ã€‚", "å‘å…¨é«”å“¡å·¥ç™¼å¸ƒæ´»å‹•çµæœã€‚", "åƒ…è¨˜éŒ„æ´»å‹•éç¨‹ï¼Œç„¡éœ€æ‡‰ç”¨åˆ°å…¶ä»–åœ°æ–¹ã€‚"], correctAnswerIndex: 1, step: "æª¢è¨èˆ‡ä¸‹ä¸€æ­¥", feedback_correct: "ğŸš€ æ­£ç¢ºï¼å¥½çš„æ”¹å–„è¦èƒ½å•Ÿç™¼ä¸‹ä¸€å€‹è¡Œå‹•ï¼Œç¸½çµç¶“é©—ä¸¦æå‡ºå±•æœ›ã€‚", feedback_incorrect: "ğŸ’¡ ç¸½çµæ´»å‹•å’Œæå‡ºæœªä¾†å±•æœ›ï¼Œæ‰èƒ½è®“ QCC å½¢æˆæŒçºŒæ”¹å–„çš„å¾ªç’°ï¼" }] }
        ];

        const SOLUTION_STEPS_DATA = [
            // âœ… èª²é”å‹æ­¥é©Ÿ (èª²é¡Œé”æˆå‹)
            { id: 1, name: "é¸å®šèª²é¡Œ", quiz: [{ question: "QCC é¸æ“‡ã€èª²é¡Œé”æˆå‹ã€èª²é¡Œæ™‚ï¼Œä¾æ“šçš„ä¸»è¦æ–¹å‘æ˜¯ä»€éº¼ï¼Ÿ", options: ["å¾ç¾å ´å•é¡Œä¸­æŒ‘é¸å½±éŸ¿è¼ƒå¤§çš„é …ç›®ã€‚", "æ ¹æ“šå…¬å¸æ–¹é‡æˆ–éƒ¨é–€ä¸­é•·æœŸç›®æ¨™ä¾†é¸æ“‡ã€‚", "ç”±æœ€é«˜ç®¡ç†å±¤ç›´æ¥æŒ‡å®šã€‚", "æˆå“¡å€‹äººæ„Ÿèˆˆè¶£ä¸”å®¹æ˜“åŸ·è¡Œçš„é …ç›®ã€‚"], correctAnswerIndex: 1, step: "é¸å®šèª²é¡Œ", feedback_correct: "ğŸ¯ å®Œç¾å‘½ä¸­ï¼èª²é¡Œé”æˆå‹æ›´æ³¨é‡èˆ‡çµ„ç¹”ç­–ç•¥ç›®æ¨™çš„é€£çµã€‚", feedback_incorrect: "ğŸ¤” ç­”éŒ¯å›‰ï¼èª²é¡Œé”æˆå‹é€šå¸¸æ˜¯è‡ªä¸Šè€Œä¸‹çš„ï¼Œä»¥ç›®æ¨™ç‚ºå°å‘ï¼Œè€Œéè§£æ±ºç¾æœ‰å•é¡Œã€‚" }] },
            { id: 2, name: "ç¾ç‹€åˆ†æ", quiz: [{ question: "ã€ç¾ç‹€åˆ†æã€çš„é—œéµæ˜¯æ‰¾å‡ºä»€éº¼ï¼Ÿ", options: ["æ‰¾å‡ºæ‰€æœ‰å¯èƒ½çš„å°ç­–ã€‚", "æŒæ¡ç¾æ³èˆ‡å…¬å¸ç›®æ¨™ä¹‹é–“çš„ã€å·®è·ã€ã€‚", "ä½¿ç”¨é­šéª¨åœ–æ‰¾å‡ºæ ¹æœ¬åŸå› ã€‚", "åˆ¶å®šè©³ç´°çš„å¯¦æ–½è¨ˆç•«ã€‚"], correctAnswerIndex: 1, step: "ç¾ç‹€åˆ†æ", feedback_correct: "âœ… æ­£ç¢ºï¼èª²é¡Œé”æˆå‹åˆ†æç¾ç‹€æ˜¯ç‚ºäº†é‡åŒ–ã€ç›®æ¨™èˆ‡ç¾æ³ä¹‹é–“çš„è½å·®ã€ã€‚", feedback_incorrect: "ğŸ” æ¥è¿‘äº†ï¼èª²é¡Œé”æˆå‹åˆ†æç¾æ³çš„é‡é»æ˜¯æ‰¾å‡ºèˆ‡ç›®æ¨™ä¹‹é–“çš„å·®è·ï¼Œä»¥ä¾¿æ“¬å®šç­–ç•¥ã€‚" }] },
            { id: 3, name: "ç›®æ¨™è¨­å®š", quiz: [{ question: "è¨­å®šèª²é¡Œé”æˆå‹ç›®æ¨™æ™‚ï¼Œé™¤äº†æ•¸å€¼å¤–ï¼Œé‚„éœ€å…·å‚™å“ªé …é‡è¦è³‡è¨Šï¼Ÿ", options: ["å°ç­–çš„è©³ç´°å¯¦æ–½æ­¥é©Ÿã€‚", "é”æˆç›®æ¨™æ‰€éœ€çš„è³‡æºæŠ•å…¥ã€‚", "æ˜ç¢ºçš„ã€é”æˆæ™‚é–“é»ã€æˆ–æœŸé™ã€‚", "æ‰€æœ‰æˆå“¡çš„å€‹äººæœŸæœ›ã€‚"], correctAnswerIndex: 2, step: "ç›®æ¨™è¨­å®š", feedback_correct: "ğŸŒŸ å°±æ˜¯é€™å€‹ï¼èª²é¡Œé”æˆå‹ç›®æ¨™å¿…é ˆå…·å‚™æ™‚é–“æ€§ï¼Œå¦å‰‡é›£ä»¥è¿½è¹¤é”æˆç‡ã€‚", feedback_incorrect: "âŒ ç›®æ¨™éœ€è¦å…·å‚™æ™‚é–“æ€§ï¼Œæ‰èƒ½ç´å…¥è¨ˆç•«ç®¡ç†ä¸­ï¼Œç¢ºä¿é€²åº¦ï¼" }] },
            { id: 4, name: "è¦å› åˆ†æ", quiz: [{ question: "åœ¨ã€è¦å› åˆ†æã€ä¸­ï¼Œä¸»è¦ç›®çš„æ˜¯æ‰¾å‡ºå“ªäº›å› ç´ ï¼Ÿ", options: ["éå»é€ æˆå“è³ªå•é¡Œçš„æ ¹æœ¬åŸå› ã€‚", "å½±éŸ¿ã€ç›®æ¨™é”æˆã€çš„ä¸»è¦éšœç¤™æˆ–è®Šå‹•å› ç´ ã€‚", "ç«¶çˆ­å°æ‰‹çš„ç”¢å“å„ªå‹¢ã€‚", "æ‰€æœ‰å¯èƒ½çš„å°ç­–èˆ‡æ–¹æ¡ˆã€‚"], correctAnswerIndex: 1, step: "è¦å› åˆ†æ", feedback_correct: "ğŸ’¡ è°æ˜ï¼èª²é¡Œé”æˆå‹é—œæ³¨çš„æ˜¯ã€ç›®æ¨™é”æˆã€çš„éšœç¤™ï¼Œè€Œä¸æ˜¯ç¾æœ‰å•é¡Œçš„åŸå› ã€‚", feedback_incorrect: "ğŸ˜µâ€ å–”å–”ï¼è¦å› åˆ†æçš„é‡é»æ˜¯æ‰¾å‡ºé”æˆç›®æ¨™è·¯å¾‘ä¸Šçš„ã€é˜»åŠ›ã€ï¼" }] },
            { id: 5, name: "å°ç­–æ“¬å®š", quiz: [{ question: "åˆ¶å®šèª²é¡Œé”æˆå‹å°ç­–æ™‚ï¼Œä¸»è¦ç›®çš„æ˜¯ç¢ºä¿è¨ˆç•«èƒ½é”åˆ°ä»€éº¼è¦æ±‚ï¼Ÿ", options: ["ç¢ºä¿å°ç­–èƒ½å¤ ä¸€æ¬¡æ€§å¾¹åº•è§£æ±ºå•é¡Œã€‚", "ç¢ºä¿å°ç­–èƒ½å¤ å½Œè£œç¾æ³èˆ‡ç›®æ¨™ä¹‹é–“çš„ã€å·®è·ã€ã€‚", "ç¢ºä¿å°ç­–è²»ç”¨æœ€ä½ã€‚", "ç¢ºä¿å°ç­–æœ€å…·å‰µæ–°æ€§ã€‚"], correctAnswerIndex: 1, step: "å°ç­–æ“¬å®š", feedback_correct: "ğŸ‘ æ²’éŒ¯ï¼å°ç­–æ˜¯å½Œè£œå·®è·çš„æ‰‹æ®µï¼Œå¿…é ˆæœ‰ç­–ç•¥æ€§ã€‚", feedback_incorrect: "ğŸš§ å°å¿ƒï¼èª²é¡Œé”æˆå‹å°ç­–çš„æˆ°ç•¥ç›®æ¨™æ˜¯å½Œè£œåˆ†æéšæ®µæ‰¾å‡ºçš„ç›®æ¨™å·®è·ã€‚" }] },
            { id: 6, name: "å¯¦æ–½è¨ˆç•«", quiz: [{ question: "åœ¨ã€å¯¦æ–½è¨ˆç•«ã€éšæ®µï¼Œç‚ºäº†ç¢ºä¿è³‡æºæœ‰æ•ˆåˆ©ç”¨ï¼Œæœ€é—œéµçš„å‹•ä½œæ˜¯ï¼Ÿ", options: ["é€²è¡Œå…¨å“¡æ•™è‚²è¨“ç·´ã€‚", "æ˜ç¢ºè²¬ä»»äººã€æ™‚ç¨‹ã€é ç®—èˆ‡è¿½è¹¤æ©Ÿåˆ¶ã€‚", "é€²è¡Œå°ç­–çš„åˆæ­¥è©¦é©—ã€‚", "æ’°å¯«è©³ç´°çš„ç¸½çµå ±å‘Šã€‚"], correctAnswerIndex: 1, step: "å¯¦æ–½è¨ˆç•«", feedback_correct: "ğŸ“… æ­£ç¢ºï¼æ˜ç¢ºçš„æ¬Šè²¬å’Œè³‡æºåˆ†é…ï¼Œæ˜¯å¯¦æ–½è¨ˆç•«é †åˆ©æ¨é€²çš„ä¿éšœã€‚", feedback_incorrect: "âŒ å¯¦æ–½è¨ˆç•«çš„é‡é»æ˜¯è³‡æºèˆ‡é€²åº¦è¿½è¹¤ï¼Œå¿…é ˆæ˜ç¢ºåˆ†é…æ¬Šè²¬ï¼" }] },
            { id: 7, name: "æ•ˆæœç¢ºèª", quiz: [{ question: "èª²é¡Œé”æˆå‹çš„ã€æ•ˆæœç¢ºèªã€ä¸»è¦é—œæ³¨ä»€éº¼ï¼Ÿ", options: ["æ˜¯å¦å¸¶ä¾†é¡å¤–çš„å£«æ°£æå‡ã€‚", "æ˜¯å¦é”åˆ°é å…ˆè¨­å®šçš„ã€ç›®æ¨™é”æˆç‡ã€ã€‚", "æ˜¯å¦æœ‰å½¢èˆ‡ç„¡å½¢æ•ˆæœã€‚", "å°ç­–å¯¦æ–½çš„é›£æ˜“åº¦ã€‚"], correctAnswerIndex: 1, step: "æ•ˆæœç¢ºèª", feedback_correct: "ğŸ’° å°ˆæ¥­ï¼èª²é¡Œé”æˆå‹æœ€ç›´æ¥çš„è©•ä¼°å°±æ˜¯é”æˆç›®æ¨™çš„ç¨‹åº¦ã€‚", feedback_incorrect: "ğŸ‘€ ç­”éŒ¯äº†ï¼èª²é¡Œé”æˆå‹æœ€æ ¸å¿ƒçš„æŒ‡æ¨™å°±æ˜¯ç›®æ¨™é”æˆç‡ï¼Œé€™æ˜¯æª¢è¦–èª²é¡Œæ˜¯å¦å®Œæˆçš„ä¾æ“šã€‚" }] },
            { id: 8, name: "æ¨™æº–åŒ–èˆ‡ç¶­æŒ", quiz: [{ question: "èª²é¡Œé”æˆå‹ã€æ¨™æº–åŒ–èˆ‡ç¶­æŒã€çš„ä¸»è¦ç›®çš„æ˜¯ä»€éº¼ï¼Ÿ", options: ["å°‡æˆåŠŸçš„ã€æ–°æ–¹æ³•ã€æˆ–ã€æ–°æ¨™æº–ã€åˆ¶åº¦åŒ–ã€‚", "è¨ˆç®—æˆå“¡çš„å€‹äººç¸¾æ•ˆçé‡‘ã€‚", "æ‰¾å‡ºä¸‹ä¸€è¼ªçš„æ”¹å–„èª²é¡Œã€‚", "èˆ‰è¡Œæ…¶ç¥æ´»å‹•ã€‚"], correctAnswerIndex: 0, step: "æ¨™æº–åŒ–èˆ‡ç¶­æŒ", feedback_correct: "ğŸ‘‘ æ²’éŒ¯ï¼æˆåŠŸé”æˆç›®æ¨™å¾Œï¼Œéœ€å°‡æ–°çš„ã€æ›´å¥½çš„åšæ³•å›ºåŒ–ç‚ºæ¨™æº–ã€‚", feedback_incorrect: "ğŸ”’ æ¨™æº–åŒ–æ˜¯å°‡æˆåŠŸç¶“é©—è½‰ç‚ºå¸¸è¦ä½œæ¥­ï¼Œé˜²æ­¢é€€æ­¥ï¼" }] },
            { id: 9, name: "æª¢è¨èˆ‡å±•æœ›", quiz: [{ question: "èª²é¡Œé”æˆå‹ QCC çš„ã€æª¢è¨èˆ‡å±•æœ›ã€éšæ®µçš„æ ¸å¿ƒè¼¸å‡ºæ˜¯ä»€éº¼ï¼Ÿ", options: ["å‘ç®¡ç†å±¤ç”³è«‹è³‡é‡‘ã€‚", "ç¸½çµæ´»å‹•ï¼Œä¸¦æå‡ºã€æœªä¾†æŒçºŒæ”¹å–„æˆ–æ“´å¤§çš„èª²é¡Œã€ã€‚", "åƒ…è¨˜éŒ„æ´»å‹•éç¨‹ï¼Œä¸åšä»»ä½•çµè«–ã€‚", "å°æ‰€æœ‰æˆå“¡é€²è¡Œç¸¾æ•ˆè€ƒæ ¸ã€‚"], correctAnswerIndex: 1, step: "æª¢è¨èˆ‡å±•æœ›", feedback_correct: "ğŸš€ æ­£ç¢ºï¼ç¸½çµæ´»å‹•å’Œæå‡ºæœªä¾†å±•æœ›ï¼Œæ‰èƒ½è®“ QCC å½¢æˆæŒçºŒæ”¹å–„çš„å¾ªç’°ã€‚", feedback_incorrect: "ğŸ’¡ ç¸½çµæ´»å‹•å’Œæå‡ºæœªä¾†å±•æœ›ï¼Œæ‰èƒ½è®“ QCC å½¢æˆæŒçºŒæ”¹å–„çš„å¾ªç’°ï¼" }] }
        ];
        
        // å…¨åŸŸç‹€æ…‹è®Šæ•¸
        let currentQuestions = []; // å„²å­˜ç•¶å‰æ¨¡å¼çš„ 9 é¡Œ
        let currentQuestionIndex = -1;
        let userScore = 0;
        let quizInProgress = false;
        let stepPerformance = {}; // è¿½è¹¤æ¯å€‹ QCC æ­¥é©Ÿçš„è¡¨ç¾
        let selectedQuizType = 'problem'; // å„²å­˜é¸æ“‡çš„é¡å‹

        // DOM å…ƒç´ å¼•ç”¨
        const app = document.getElementById('app');
        const mainTitle = document.getElementById('mainTitle'); 
        const welcomeScreen = document.getElementById('welcomeScreen'); 
        const progressSection = document.getElementById('progressSection'); 
        const selectProblemType = document.getElementById('selectProblemType'); 
        const selectSolutionType = document.getElementById('selectSolutionType'); 
        
        const quizQuestion = document.getElementById('quizQuestion');
        const quizOptions = document.getElementById('quizOptions');
        const quizFeedback = document.getElementById('quizFeedback');
        const mainActionBtn = document.getElementById('mainActionBtn');
        const progressDisplay = document.getElementById('progressDisplay');
        const progressBar = document.getElementById('progressBar');
        const resultContainer = document.getElementById('resultContainer');
        const quizContainer = document.getElementById('quizContainer');

        /**
         * è™•ç†ä¸»æŒ‰éˆ•é»æ“Šäº‹ä»¶ï¼šä¸‹ä¸€é¡Œ/æŸ¥çœ‹çµæœ (åªè™•ç†æ¸¬é©—é€²è¡Œä¸­çš„æµç¨‹)
         */
        function handleMainAction() {
            if (currentQuestionIndex < currentQuestions.length) {
                // é€²å…¥ä¸‹ä¸€é¡Œ (in-quiz flow)
                currentQuestionIndex++;
                if (currentQuestionIndex < currentQuestions.length) {
                    displayQuestion();
                    // é€²å…¥ä¸‹ä¸€é¡Œå¾Œå†æ¬¡ç¦ç”¨ï¼Œç­‰å¾…ä½œç­”
                    mainActionBtn.textContent = 'é€²è¡Œä¸‹ä¸€é¡Œ';
                    mainActionBtn.disabled = true; 
                    // éš±è—å›é¥‹å€å¡Š
                    quizFeedback.classList.add('hidden');
                    quizFeedback.className = 'hidden mt-6 p-4 text-center rounded-xl font-bold transition-all duration-300 transform scale-100 border-2';
                } else {
                    // æ¸¬é©—çµæŸ
                    showResults();
                }
            }
        }

        /**
         * æ ¹æ“šé¸æ“‡çš„é¡å‹é–‹å§‹æ¸¬é©—
         * @param {string} quizType - 'problem' or 'solution'
         */
        function startQuiz(quizType) {
            selectedQuizType = quizType;
            
            // æ ¹æ“šé¸æ“‡çš„é¡å‹è¼‰å…¥å°æ‡‰çš„é¡Œç›®é›†
            if (quizType === 'problem') {
                currentQuestions = PROBLEM_STEPS_DATA.flatMap(step => step.quiz);
                mainTitle.innerHTML = 'ğŸ› ï¸ QCC å•é¡Œè§£æ±ºå‹æŒ‘æˆ° ğŸ¯';
            } else if (quizType === 'solution') {
                currentQuestions = SOLUTION_STEPS_DATA.flatMap(step => step.quiz);
                mainTitle.innerHTML = 'âœ¨ QCC èª²é¡Œé”æˆå‹æŒ‘æˆ° ğŸš€';
            }

            // éš±è—æ­¡è¿ç•«é¢ï¼Œé¡¯ç¤ºæ¸¬é©—å€å¡Š
            welcomeScreen.classList.add('hidden');
            progressSection.classList.remove('hidden');
            quizContainer.classList.remove('hidden');

            currentQuestionIndex = 0; 
            quizInProgress = true;
            displayQuestion();
            mainActionBtn.textContent = 'é€²è¡Œä¸‹ä¸€é¡Œ';
            mainActionBtn.disabled = true; // éœ€å…ˆé¸æ“‡ç­”æ¡ˆæ‰èƒ½ç¹¼çºŒ
            resultContainer.classList.add('hidden');
            
            // ç¢ºä¿æ¯æ¬¡é–‹å§‹æ¸¬é©—æ™‚éƒ½é‡æ–°æ‰“äº‚é¡Œç›®
            shuffleArray(currentQuestions);
        }

        /**
         * é¡¯ç¤ºç•¶å‰é¡Œç›®
         */
        function displayQuestion() {
            const currentQuestion = currentQuestions[currentQuestionIndex];
            
            // æ›´æ–°é€²åº¦é¡¯ç¤º
            updateProgressDisplay();

            // æ›´æ–°é¡Œç›®
            quizQuestion.innerHTML = `<span class="text-pink-500">[${currentQuestion.step}]</span> ${currentQuestion.question}`;
            
            // æ›´æ–°é¸é …
            quizOptions.innerHTML = '';
            
            currentQuestion.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                // æ‡‰ç”¨å¤§å€å¡Šæ¨£å¼
                optionElement.className = `answer-option bg-white p-5 md:p-6 rounded-xl shadow-md hover:shadow-lg transition-all duration-300 border-purple-200 text-lg md:text-xl font-medium text-gray-700`;
                optionElement.innerHTML = `
                    <span class="inline-block w-6 h-6 text-center bg-purple-100 text-purple-600 rounded-full mr-3 border-2 border-purple-300 font-bold">${String.fromCharCode(65 + index)}</span>
                    ${option}
                `;
                optionElement.dataset.index = index;
                
                // åŠ ä¸Šé»æ“Šäº‹ä»¶
                optionElement.addEventListener('click', () => selectAnswer(index, optionElement, currentQuestion));
                quizOptions.appendChild(optionElement);
            });
            
            // ç¢ºä¿å›é¥‹å€å¡Šæ˜¯éš±è—çš„
            quizFeedback.classList.add('hidden');
            // æ¸…é™¤ä¸Šæ¬¡çš„æŒ‰éˆ•ç‹€æ…‹ï¼Œé‡æ–°ç¶å®šé¸é …é»æ“Š
            quizOptions.querySelectorAll('.answer-option').forEach(el => el.classList.remove('disabled'));
        }

        /**
         * è™•ç†ç”¨æˆ¶é»æ“Šç­”æ¡ˆçš„äº‹ä»¶
         * @param {number} selectedIndex - ç”¨æˆ¶é¸æ“‡çš„é¸é …ç´¢å¼•
         * @param {HTMLElement} selectedElement - ç”¨æˆ¶é»æ“Šçš„é¸é … DOM å…ƒç´ 
         * @param {object} questionData - ç•¶å‰å•é¡Œçš„è³‡æ–™
         */
        function selectAnswer(selectedIndex, selectedElement, questionData) {
            const correct = selectedIndex === questionData.correctAnswerIndex;
            
            // 1. ç¦ç”¨æ‰€æœ‰é¸é …ï¼Œé˜²æ­¢é‡è¤‡é»æ“Š
            quizOptions.querySelectorAll('.answer-option').forEach(el => {
                el.classList.add('disabled');
                // ç§»é™¤åŸæœ‰çš„ hover æ•ˆæœ
                el.classList.remove('hover:shadow-lg', 'hover:shadow-lg', 'hover:shadow-2xl');
                el.style.pointerEvents = 'none'; // å¾¹åº•ç¦ç”¨
            });

            // 2. è™•ç†åˆ†æ•¸å’Œè¿½è¹¤
            const stepName = questionData.step;
            if (stepPerformance[stepName] === undefined) {
                 stepPerformance[stepName] = { correct: 0, total: 0 };
            }
            stepPerformance[stepName].total++; 
            
            // 3. çµ¦äºˆèª‡å¼µçš„è¦–è¦ºå›é¥‹
            let feedbackText = '';
            let feedbackClass = '';

            if (correct) {
                userScore++;
                stepPerformance[stepName].correct++;
                // åŠ ä¸Šæ­£ç¢ºç­”æ¡ˆçš„é–ƒçˆå‹•ç•«
                selectedElement.classList.add('correct-blink');
                
                feedbackText = `<span class="text-3xl mr-3">ğŸ‰</span> ${questionData.feedback_correct || "ğŸ¯ ç­”å°äº†ï¼ä½ çœŸæ˜¯å€‹ QCC å°å¤©æ‰ï¼"}`;
                feedbackClass = 'bg-green-50 text-green-700 border-green-500 shadow-green-200';
            } else {
                // åŠ ä¸ŠéŒ¯èª¤ç­”æ¡ˆçš„æ™ƒå‹•å‹•ç•«
                selectedElement.classList.add('incorrect-shake');

                // æ¨™ç¤ºå‡ºæ­£ç¢ºç­”æ¡ˆ
                const correctElement = quizOptions.querySelector(`[data-index="${questionData.correctAnswerIndex}"]`);
                if (correctElement) {
                    correctElement.classList.remove('bg-white', 'border-purple-200');
                    correctElement.classList.add('bg-green-200', 'border-green-500', 'shadow-inner');
                }

                feedbackText = `<span class="text-3xl mr-3">âŒ</span> ${questionData.feedback_incorrect || "ğŸ’¡ ç­”éŒ¯äº†ï¼æ²’é—œä¿‚ï¼Œçœ‹çœ‹æ­£ç¢ºç­”æ¡ˆæ˜¯å“ªä¸€å€‹ï¼"}`;
                feedbackClass = 'bg-red-50 text-red-700 border-red-500 shadow-red-200';
            }
            
            // 4. é¡¯ç¤ºå›é¥‹å€å¡Š
            quizFeedback.className = `mt-6 p-4 text-center rounded-xl font-bold transition-all duration-300 transform scale-100 border-2 ${feedbackClass}`;
            quizFeedback.innerHTML = feedbackText;
            quizFeedback.classList.remove('hidden');

            // 5. å•Ÿç”¨ä¸»è¦æŒ‰éˆ•ï¼Œè®“ç”¨æˆ¶æ‰‹å‹•é»æ“Šä¸‹ä¸€é¡Œ
            mainActionBtn.textContent = (currentQuestionIndex < currentQuestions.length - 1) ? 'ç¹¼çºŒä¸‹ä¸€é¡Œ' : 'æŸ¥çœ‹æœ€çµ‚æˆæœï¼';
            mainActionBtn.disabled = false;
        }

        /**
         * æ›´æ–°é€²åº¦æ¢å’Œæ–‡å­—é¡¯ç¤º
         */
        function updateProgressDisplay() {
            const total = currentQuestions.length;
            const current = currentQuestionIndex + 1;
            const percentage = (current / total) * 100;
            
            progressDisplay.textContent = `ç¬¬ ${current} é¡Œ / å…± ${total} é¡Œ | ç›®å‰å¾—åˆ†: ${userScore} åˆ†`;
            progressBar.style.width = `${percentage}%`;
        }

        /**
         * é¡¯ç¤ºæœ€çµ‚çµæœå’Œåˆ†æ
         */
        function showResults() {
            quizInProgress = false;
            quizContainer.classList.add('hidden');
            progressSection.classList.add('hidden'); // éš±è—é€²åº¦æ¢
            resultContainer.classList.remove('hidden');
            
            const totalQuestions = currentQuestions.length;
            const percentage = Math.round((userScore / totalQuestions) * 100);

            let resultTitle = '';
            let resultClass = '';
            let resultText = '';
            
            // æ ¹æ“šé¸æ“‡çš„é¡å‹å¾®èª¿çµæœæè¿°
            const typeLabel = selectedQuizType === 'problem' ? 'å•é¡Œè§£æ±ºå‹ (å•é¡Œè§£æ±ºå‹)' : 'èª²é”å‹ (èª²é¡Œé”æˆå‹)';
            const stepData = selectedQuizType === 'problem' ? PROBLEM_STEPS_DATA : SOLUTION_STEPS_DATA;


            if (percentage >= 90) {
                resultTitle = 'ğŸ‰ å‚³å¥‡å¤§å¸«ç´šï¼';
                resultText = `ä½ åœ¨ ${typeLabel} é ˜åŸŸçš„ QCC çŸ¥è­˜å·²é”é ‚å°–æ°´å¹³ï¼æ‰€æœ‰æ­¥é©Ÿéƒ½æŒæ¡å¾—éå¸¸ç´®å¯¦ï¼Œå¯ä»¥æ“”ä»»å°å¸«äº†ï¼`;
                resultClass = 'text-green-700 border-green-500 bg-green-100';
            } else if (percentage >= 70) {
                resultTitle = 'ğŸ‘ å„ªç§€å¯¦å‹™å®¶ï¼';
                resultText = `è¡¨ç¾éå¸¸æ£’ï¼ä½ å° ${typeLabel} çš„æ ¸å¿ƒæ­¥é©Ÿæœ‰å¾ˆå¥½çš„ç†è§£ï¼Œåªéœ€è¦åœ¨ç´°ç¯€è™•å†åŠ å¼·å°±èƒ½æ›´å®Œç¾ã€‚`;
                resultClass = 'text-blue-700 border-blue-500 bg-blue-100';
            } else if (percentage >= 50) {
                resultTitle = 'ğŸ§ ç©©å¥å­¸ç¿’ä¸­ï¼';
                resultText = `ä½ å·²ç¶“æŒæ¡äº† ${typeLabel} å¤§éƒ¨åˆ†çŸ¥è­˜ï¼Œä½†é‚„æœ‰ä¸€äº›æ­¥é©Ÿéœ€è¦å›é ­è¤‡ç¿’ã€‚ç¹¼çºŒåŠªåŠ›ï¼`;
                resultClass = 'text-yellow-700 border-yellow-500 bg-yellow-100';
            } else {
                resultTitle = 'ğŸš€ æŒ‘æˆ°è€…æ¨¡å¼ï¼';
                resultText = `æ²’é—œä¿‚ï¼Œé€™åªæ˜¯é–‹å§‹ï¼é€éé€™æ¬¡ ${typeLabel} æ¸¬é©—ï¼Œä½ çŸ¥é“è©²å¾ ${typeLabel} çš„å“ªå€‹æ­¥é©Ÿè£œå¼·äº†ï¼`;
                resultClass = 'text-red-700 border-red-500 bg-red-100';
            }

            // å¼±é»åˆ†æ HTML
            let analysisHTML = `
                <h3 class="text-2xl font-bold text-gray-700 mt-8 mb-4 border-b-2 border-dashed pb-2">ğŸ§  çŸ¥è­˜å¼±é»åˆ†æ (${typeLabel})</h3>
                <p class="text-gray-600 mb-4">æ ¹æ“šä½ çš„ä½œç­”ï¼Œæˆ‘å€‘ç‚ºä½ åˆ†æäº†åœ¨ QCC ä¹å¤§æ­¥é©Ÿä¸­ï¼Œå“ªå€‹ç’°ç¯€å¯èƒ½éœ€è¦åŠ å¼·ï¼š</p>
                <ul class="space-y-3">
            `;

            // ç¢ºä¿æŒ‰é †åºé¡¯ç¤º 9 å€‹æ­¥é©Ÿçš„è¡¨ç¾ï¼Œä¸¦å¾ stepData ä¸­ç²å–æ­¥é©Ÿåç¨±
            stepData.forEach(step => {
                const stepName = step.name;
                
                // å¾ stepPerformance ä¸­å–å‡ºè¿½è¹¤çš„æ•¸æ“š
                const performance = stepPerformance[stepName] || { correct: 0, total: 0 };
                
                // ç”±æ–¼æ˜¯å–®ä¸€é¡Œç›®çš„æ¸¬é©—æ¨¡å¼ï¼Œtotal æ‡‰è©²æ˜¯ 1
                const totalInStep = 1; 
                
                if (performance.total > 0) {
                    const accuracy = (performance.correct / totalInStep) * 100;
                    let icon = 'ğŸŸ¢';
                    let textClass = 'text-green-600';
                    if (accuracy < 50) {
                        icon = 'ğŸ”´';
                        textClass = 'text-red-600 font-bold';
                    } else if (accuracy < 100) { 
                        icon = 'ğŸŸ¡';
                        textClass = 'text-yellow-600';
                    }

                    analysisHTML += `
                        <li class="flex items-center p-2 bg-gray-50 rounded-lg shadow-sm">
                            <span class="mr-3 text-xl">${icon}</span>
                            <span class="font-semibold w-1/3">${step.id}. ${stepName}:</span>
                            <span class="${textClass}">${performance.correct} / ${totalInStep} é¡Œ (${accuracy.toFixed(0)}%)</span>
                        </li>
                    `;
                }
            });

            analysisHTML += `</ul>`;

            resultContainer.innerHTML = `
                <h2 class="text-3xl md:text-4xl font-extrabold text-center mb-4 ${resultClass}">${resultTitle}</h2>
                <p class="text-center text-xl text-gray-600 mb-6">ç¸½å¾—åˆ†ï¼š${userScore} / ${totalQuestions} é¡Œ</p>
                <div class="p-4 rounded-xl ${resultClass} text-center font-semibold">
                    ${resultText}
                </div>
                
                ${analysisHTML} <!-- æ³¨å…¥å¼±é»åˆ†æå€å¡Š -->
                
                <button id="restartQuizBtn" class="fun-action-btn w-full mt-8 py-4 text-2xl font-bold rounded-xl shadow-lg hover:shadow-2xl">
                    å†ä¾†ä¸€è¼ªæŒ‘æˆ°ï¼
                </button>
            `;
            
            // é‡æ–°é–‹å§‹åŠŸèƒ½ï¼šç¶å®šåˆ°æ–°çš„æŒ‰éˆ•ä¸Š
            document.getElementById('restartQuizBtn').addEventListener('click', initializeQuiz);

            // ç¢ºä¿ä¸»æŒ‰éˆ•è¢«ç§»é™¤äº‹ä»¶ä¸¦ä¿æŒéš±è—
            mainActionBtn.removeEventListener('click', handleMainAction);
        }
        
        // éš¨æ©Ÿæ‰“äº‚æ•¸çµ„
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        /**
         * åˆå§‹åŒ–æ¸¬é©—ç‹€æ…‹å’Œ UI (ç¾åœ¨æ˜¯é¡å‹é¸æ“‡ç•«é¢)
         */
        function initializeQuiz() {
            currentQuestionIndex = -1;
            userScore = 0;
            quizInProgress = false;
            stepPerformance = {}; // é‡ç½®è¿½è¹¤
            selectedQuizType = 'problem'; // é‡ç½®ç‚ºé è¨­å€¼
            currentQuestions = []; // æ¸…é™¤ç•¶å‰é¡Œç›®

            // é‡ç½®ä¸»æ¨™é¡Œ
            mainTitle.innerHTML = 'ğŸ› ï¸ QCC çŸ¥è­˜é»é»å ğŸ¯';

            // é‡ç½® UI é¡¯ç¤º
            welcomeScreen.classList.remove('hidden'); // é¡¯ç¤ºæ­¡è¿ç•«é¢/é¡å‹é¸æ“‡
            progressSection.classList.add('hidden'); // éš±è—é€²åº¦æ¢
            quizContainer.classList.add('hidden'); // éš±è—æ¸¬é©—ä¸»é«”
            resultContainer.classList.add('hidden'); // éš±è—çµæœ

            
            // ç¶å®šé¡å‹é¸æ“‡æŒ‰éˆ•åˆ° startQuiz
            selectProblemType.onclick = () => startQuiz('problem');
            selectSolutionType.onclick = () => startQuiz('solution');
            
            // ç¢ºä¿ in-quiz flow çš„æŒ‰éˆ•ä¹Ÿç¶å®šæ­£ç¢º
            mainActionBtn.removeEventListener('click', handleMainAction);
            mainActionBtn.addEventListener('click', handleMainAction);
        }

        // é é¢è¼‰å…¥æ™‚åŸ·è¡Œåˆå§‹åŒ–ï¼ˆæ”¯æ´ç¨ç«‹é–‹å•Ÿèˆ‡è¢« index å‹•æ…‹è¼‰å…¥ï¼‰
if (document.readyState === 'loading') {
    // è‹¥æ•´å€‹æ–‡ä»¶é‚„åœ¨è¼‰å…¥ï¼Œå°±ç­‰ DOMContentLoaded å†è·‘
    document.addEventListener('DOMContentLoaded', initializeQuiz);
} else {
    // è‹¥å·²ç¶“è¼‰å…¥å®Œæˆï¼ˆåŒ…å«è¢«å‹•æ…‹å¡é€²å»çš„æƒ…æ³ï¼‰ï¼Œç›´æ¥åˆå§‹åŒ–
    initializeQuiz();
}

    </script>
</body>
</html>
