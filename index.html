<!DOCTYPE html>
<html lang="zh-TW" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>品管圈（QCC）新手入門互動指南</title>
    <!-- 載入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 設置字體為 Inter -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #ecfdf5;
        }
        .section-title {
            border-left: 6px solid #0d9488;
            padding-left: 0.75rem;
            transition: all 0.3s ease-in-out;
        }
        .nav-button {
            transition: all 0.3s ease-in-out;
            border-bottom: 3px solid transparent;
        }
        .nav-button.active {
            color: #0d9488;
            border-color: #0d9488;
            font-weight: 700;
        }
        .ai-chat-response {
            white-space: pre-wrap;
        }
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #0d9488;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #backToTopBtn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
            cursor: pointer;
            width: 3rem;
            height: 3rem;
        }
        #backToTopBtn.show {
            opacity: 1;
            visibility: visible;
        }
    </style>
</head>
<body class="antialiased">

    <!-- 主要容器 -->
    <div class="max-w-6xl mx-auto p-4 sm:p-6 lg:p-8">

        <!-- 標題區塊（固定框架的一部分） -->
        <header id="header" class="text-center py-10 bg-white shadow-xl rounded-xl mb-6 border-t-8 border-teal-600">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-gray-900 mb-2">品管圈（QCC）新手入門互動指南</h1>
            <p class="text-xl text-gray-500">從概念到實踐，品質改善的旅程由此開始！</p>
        </header>

        <!-- 導航頁籤（固定框架的一部分） -->
        <nav class="sticky top-0 z-10 flex justify-center bg-white p-2 rounded-xl shadow-lg mb-8 space-x-4">
            <button id="nav-btn-home"
                    onclick="goHome()"
                    class="nav-button active text-lg px-6 py-2 text-gray-600 hover:text-teal-600 hover:border-teal-600">
                🚀 首頁
            </button>

            <button id="nav-btn-form"
                    onclick="loadExternalPage('書面格式_問題型.html', 'nav-btn-form')"
                    class="nav-button text-lg px-6 py-2 text-gray-600 hover:text-teal-600 hover:border-teal-600">
                📝 書面格式
            </button>

            <button id="nav-btn-tools"
                    onclick="loadExternalPage('參考資料.html', 'nav-btn-tools')"
                    class="nav-button text-lg px-6 py-2 text-gray-600 hover:text-teal-600 hover:border-teal-600">
                🛠️ 參考資料
            </button>
        </nav>

        <!-- 內文區：會隨頁籤切換的部分 -->

        <!-- 首頁內容：完整首頁（QCC介紹、五大類型、書面格式重點、工具總覽） -->
        <main id="page-home" class="space-y-12 mb-10">

            <!-- 區塊 A: 什麼是品管圈（QCC）？ -->
            <section id="what-is-qcc" class="bg-white p-6 sm:p-8 rounded-xl shadow-lg border-l-4 border-teal-500 hover:shadow-2xl transition duration-300">
                <h2 class="section-title text-2xl font-bold text-gray-800 mb-4" data-section-title="什麼是品管圈（QCC）？">1. 什麼是品管圈（QCC）？</h2>
                <div class="text-gray-600 leading-relaxed space-y-4">
                    <p>品管圈（Quality Control Circle, QCC）是一種持續改善活動，鼓勵<strong class="font-semibold text-teal-600">基層同仁</strong>組成小組，共同運用各種品管工具和手法，以系統性的步驟解決工作現場的問題，或達成特定的改善目標。</p>
                    <p>它不僅是一種管理工具，更是一種<strong class="font-semibold text-teal-600">品質文化</strong>的養成過程。透過這樣的活動，能培養同仁的品管意識、團隊合作能力，進而持續不斷地提升服務品質與工作效率。</p>
                </div>
                <div class="mt-8 pt-4 border-t border-gray-200">
                    <h4 class="font-semibold text-lg text-gray-700 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 13a2 2 0 012-2h10a2 2 0 012 2v1a2 2 0 01-2 2H7a2 2 0 01-2-2v-1z"></path></svg>
                        AI 輔助提問：想問點關於本節內容嗎？
                    </h4>
                    <div id="chat-what-is-qcc"></div>
                </div>
            </section>
            
            <!-- 區塊 B: 五大改善類型 -->
            <section id="tool-selection" class="bg-white p-6 sm:p-8 rounded-xl shadow-lg border-l-4 border-teal-500 hover:shadow-2xl transition duration-300">
                <h2 class="section-title text-2xl font-bold text-gray-800 mb-4" data-section-title="運用合適的品管工具解決問題（五大改善類型）">2. 運用合適的品管工具解決問題（五大改善類型）</h2>
                <p class="text-gray-600 mb-6">品質改善活動應依據問題的性質、發生時機與目標，選擇最合適的手法和工具，以達到事半功倍的效果。</p>
                
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="border-t-4 border-red-500 bg-red-50 p-4 rounded-lg shadow-md hover:shadow-lg transition duration-300">
                        <h3 class="font-bold text-xl text-red-700 mb-2">1. 問題解決型（回溯）</h3>
                        <p class="text-sm font-semibold text-red-600 mb-2">處理已發生的負面落差。</p>
                        <p class="text-sm text-gray-600">
                            適用於<strong class="font-semibold">「現狀與應有狀態」之間存在負面落差</strong>的情況。目標是解決已經發生的問題，消除不良、錯誤或低效率。
                        </p>
                    </div>
                    <div class="border-t-4 border-blue-500 bg-blue-50 p-4 rounded-lg shadow-md hover:shadow-lg transition duration-300">
                        <h3 class="font-bold text-xl text-blue-700 mb-2">2. 課題達成型（創新型）</h3>
                        <p class="text-sm font-semibold text-blue-600 mb-2">處理現狀與理想狀態的正面差距。</p>
                        <p class="text-sm text-gray-600">目標是達成更高層次的挑戰性目標，進行創新或突破現狀。</p>
                    </div>
                    <div class="border-t-4 border-green-500 bg-green-50 p-4 rounded-lg shadow-md hover:shadow-lg transition duration-300">
                        <h3 class="font-bold text-xl text-green-700 mb-2">3. 預先防範型（主動預防）</h3>
                        <p class="text-sm font-semibold text-green-600 mb-2">預測並消除潛在的失敗模式 (如 HFMEA)。</p>
                        <p class="text-sm text-gray-600">系統性地分析<strong class="font-semibold">新流程或高風險流程</strong>中所有潛在的失敗模式。</p>
                    </div>
                    <div class="border-t-4 border-purple-500 bg-purple-50 p-4 rounded-lg shadow-md hover:shadow-lg transition duration-300">
                        <h3 class="font-bold text-xl text-purple-700 mb-2">4. 回溯型（嚴重事件分析）</h3>
                        <p class="text-sm font-semibold text-purple-600 mb-2">針對已發生嚴重事件追溯原因 (如 RCA)。</p>
                        <p class="text-sm text-gray-600">針對<strong class="font-semibold">已發生或近乎發生的嚴重事件</strong>進行深入、系統性的分析。</p>
                    </div>
                    <div class="border-t-4 border-yellow-500 bg-yellow-50 p-4 rounded-lg shadow-md hover:shadow-lg transition duration-300">
                        <h3 class="font-bold text-xl text-yellow-700 mb-2">5. 流程優化與改造（效率）</h3>
                        <p class="text-sm font-semibold text-yellow-600 mb-2">著重於效率、成本或動線的改善 (IE 思維)。</p>
                        <p class="text-sm text-gray-600">對現有作業流程進行診斷，找出<strong class="font-semibold">流程中的浪費、瓶頸</strong>。</p>
                    </div>
                </div>
                <div class="mt-8 pt-4 border-t border-gray-200">
                    <h4 class="font-semibold text-lg text-gray-700 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2m-3 10h.01M9 19v2m6-2v2M5 13a2 2 0 012-2h10a2 2 0 012 2v1a2 2 0 01-2 2H7a2 2 0 01-2-2v-1z"></path></svg>
                        AI 輔助提問：想問點關於本節內容嗎？
                    </h4>
                    <div id="chat-tool-selection"></div>
                </div>
            </section>
            
            <!-- 區塊 C: 書面格式重點 -->
            <section id="qcc-steps" class="bg-white p-6 sm:p-8 rounded-xl shadow-lg border-l-4 border-fuchsia-500 mt-12">
                <h2 class="section-title text-2xl font-bold text-gray-800 mb-4" data-section-title="品管改善步驟與書面格式重點">📝 品管改善步驟與書面格式重點 (QC Story)</h2>
                <p class="text-gray-600 mb-6">問題解決型品管圈通常遵循以下十個標準步驟，這也是您撰寫報告時的骨幹結構。</p>
                
                <div class="overflow-x-auto rounded-lg shadow-md border-2 border-fuchsia-100">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-fuchsia-50">
                            <tr>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider w-1/12">No.</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider w-3/12">步驟名稱</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider w-5/12">書面報告重點 (What to Write)</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider w-3/12">關鍵工具</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200 text-sm text-gray-700">
                            <tr class="hover:bg-gray-50">
                                <td class="px-3 py-4 font-medium text-fuchsia-600">1</td>
                                <td class="px-3 py-4 whitespace-nowrap">組圈與主題選定</td>
                                <td class="px-6 py-4">說明團隊成員、圈名、選定主題的理由（急迫性、重要性）。</td>
                                <td class="px-6 py-4">腦力激盪、親和圖</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-3 py-4 font-medium text-fuchsia-600">2</td>
                                <td class="px-3 py-4 whitespace-nowrap">訂定活動計畫</td>
                                <td class="px-6 py-4">呈現甘特圖或時程表，標註各步驟預計完成時間與分工。</td>
                                <td class="px-6 py-4">系統圖、箭線圖</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-3 py-4 font-medium text-fuchsia-600">3</td>
                                <td class="px-3 py-4 whitespace-nowrap">現況把握</td>
                                <td class="px-6 py-4">
                                    用數據證明問題嚴重性，使用柏拉圖確立
                                    <strong class="font-semibold">攻堅重點</strong>。
                                </td>
                                <td class="px-6 py-4">查檢表、柏拉圖、層別法</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-3 py-4 font-medium text-fuchsia-600">4</td>
                                <td class="px-3 py-4 whitespace-nowrap">目標設定</td>
                                <td class="px-6 py-4">
                                    設定具體、可量化、可達成（<strong>SMART</strong> 原則）的目標值。
                                </td>
                                <td class="px-6 py-4">圖表</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-3 py-4 font-medium text-fuchsia-600">5</td>
                                <td class="px-3 py-4 whitespace-nowrap">解析</td>
                                <td class="px-6 py-4">繪製特性要因圖，並針對主要要因收集數據進行驗證，找出<strong class="font-semibold">真因</strong>。</td>
                                <td class="px-6 py-4">特性要因圖、散佈圖</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-3 py-4 font-medium text-fuchsia-600">6</td>
                                <td class="px-3 py-4 whitespace-nowrap">對策擬定與實施</td>
                                <td class="px-6 py-4">列出所有對策，說明篩選/評估標準，以及對策實施的詳細過程。</td>
                                <td class="px-6 py-4">系統圖、矩陣圖、PDPC</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-3 py-4 font-medium text-fuchsia-600">7</td>
                                <td class="px-3 py-4 whitespace-nowrap">效果確認</td>
                                <td class="px-6 py-4">比較改善前後數據（有形成果）和圈員成長（無形成果），與目標值對照。</td>
                                <td class="px-6 py-4">圖表、管制圖</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-3 py-4 font-medium text-fuchsia-600">8</td>
                                <td class="px-3 py-4 whitespace-nowrap">標準化</td>
                                <td class="px-6 py-4">提出將有效的對策納入 SOP 或規範的文件化說明。</td>
                                <td class="px-6 py-4">流程圖、文件化</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-3 py-4 font-medium text-fuchsia-600">9</td>
                                <td class="px-3 py-4 whitespace-nowrap">殘留問題與未來展望</td>
                                <td class="px-6 py-4">自我檢討活動過程，說明未達成的目標或待持續改善的方向。</td>
                                <td class="px-6 py-4">檢討會</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h3 class="text-xl font-bold text-fuchsia-700 mt-8 mb-3">📄 報告撰寫技巧：</h3>
                <ul class="list-disc list-outside ml-5 space-y-2 text-gray-600">
                    <li><strong>視覺化優先：</strong>盡量使用圖表、照片來代替文字，使審查者能快速掌握重點。</li>
                    <li><strong>數據說話：</strong>所有結論都必須有數據（查檢表、柏拉圖等）作為佐證。</li>
                    <li><strong>遵循流程：</strong>報告的章節和順序必須嚴格遵循 QC Story 的步驟。</li>
                    <li><strong>簡潔有力：</strong>避免過多不必要的贅述，每個步驟聚焦於核心產出。</li>
                </ul>
                <div class="mt-8 pt-4 border-t border-gray-200">
                    <h4 class="font-semibold text-lg text-gray-700 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        AI 輔助提問：想問點關於格式嗎？
                    </h4>
                    <div id="chat-qcc-format"></div>
                </div>
            </section>

            <!-- 區塊 D: 參考資料（工具） -->
            <section id="qc-tools" class="bg-white p-6 sm:p-8 rounded-xl shadow-lg border-l-4 border-cyan-500 mt-12">
                <h2 class="section-title text-2xl font-bold text-gray-800 mb-4" data-section-title="常用品管工具總覽">🛠️ 常用品管工具總覽（QC 七手法與新七手法）</h2>
                <p class="text-gray-600 mb-6">品管工具是 QCC 活動中用來收集、整理、分析數據與資訊的輔助手段。正確使用它們能大大提高改善效率！</p>

                <h3 class="font-bold text-xl text-teal-700 mb-3 border-b pb-1">舊QC七手法（QC 7 Tools）- 數據分析與統計</h3>
                <div class="overflow-x-auto rounded-lg shadow-md mb-8 border-2 border-teal-100">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-teal-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">工具名稱</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">主要功能（用途）</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">適用步驟</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200 text-sm text-gray-700">
                            <tr class="hover:bg-gray-50"><td class="px-6 py-4 font-medium whitespace-nowrap">柏拉圖 (Pareto Chart)</td><td class="px-6 py-4">找出影響最大的「重要少數」（80/20法則）。</td><td class="px-6 py-4">現況把握、效果確認</td></tr>
                            <tr class="hover:bg-gray-50"><td class="px-6 py-4 font-medium whitespace-nowrap">特性要因圖 (Fishbone)</td><td class="px-6 py-4">系統性整理問題的所有可能原因（找出要因）。</td><td class="px-6 py-4">解析</td></tr>
                            <tr class="hover:bg-gray-50"><td class="px-6 py-4 font-medium whitespace-nowrap">查檢表 (Check Sheet)</td><td class="px-6 py-4">系統性地收集數據、記錄次數。</td><td class="px-6 py-4">現況把握、效果確認</td></tr>
                            <tr class="hover:bg-gray-50"><td class="px-6 py-4 font-medium whitespace-nowrap">層別法 (Stratification)</td><td class="px-6 py-4">將數據按不同屬性分類，釐清問題的發生源。</td><td class="px-6 py-4">現況把握、解析</td></tr>
                            <tr class="hover:bg-gray-50"><td class="px-6 py-4 font-medium whitespace-nowrap">散佈圖 (Scatter Diagram)</td><td class="px-6 py-4">分析兩組數據之間是否存在相關性。</td><td class="px-6 py-4">解析</td></tr>
                            <tr class="hover:bg-gray-50"><td class="px-6 py-4 font-medium whitespace-nowrap">管制圖 (Control Chart)</td><td class="px-6 py-4">監控過程是否處於穩定狀態，用於長期品質維持。</td><td class="px-6 py-4">效果確認、標準化</td></tr>
                            <tr class="hover:bg-gray-50"><td class="px-6 py-4 font-medium whitespace-nowrap">直方圖 (Histogram)</td><td class="px-6 py-4">顯示數據的分佈形態與集中趨勢。</td><td class="px-6 py-4">現況把握、效果確認</td></tr>
                        </tbody>
                    </table>
                </div>

                <h3 class="font-bold text-xl text-blue-700 mb-3 border-b pb-1">新QC七手法（New QC 7 Tools）- 語言資料整理與創新</h3>
                <div class="overflow-x-auto rounded-lg shadow-md border-2 border-blue-100">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-blue-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">工具名稱</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">主要功能（用途）</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">適用步驟</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200 text-sm text-gray-700">
                            <tr class="hover:bg-gray-50"><td class="px-6 py-4 font-medium whitespace-nowrap">親和圖 (Affinity Diagram)</td><td class="px-6 py-4">整理大量發散的語言資料/想法，進行分組歸納。</td><td class="px-6 py-4">主題選定、解析</td></tr>
                            <tr class="hover:bg-gray-50"><td class="px-6 py-4 font-medium whitespace-nowrap">關聯圖 (Relation Diagram)</td><td class="px-6 py-4">釐清複雜問題中，各因素之間糾結的因果關係。</td><td class="px-6 py-4">解析（複雜原因分析）</td></tr>
                            <tr class="hover:bg-gray-50"><td class="px-6 py-4 font-medium whitespace-nowrap">系統圖 (Systematic Diagram)</td><td class="px-6 py-4">將目標系統性地分解為達成該目標所需要的手段。</td><td class="px-6 py-4">對策擬定、訂定活動計畫</td></tr>
                            <tr class="hover:bg-gray-50"><td class="px-6 py-4 font-medium whitespace-nowrap">矩陣圖 (Matrix Diagram)</td><td class="px-6 py-4">分析兩組要素之間的相互關係與強度。</td><td class="px-6 py-4">對策擬定</td></tr>
                            <tr class="hover:bg-gray-50"><td class="px-6 py-4 font-medium whitespace-nowrap">過程決策計畫圖 (PDPC)</td><td class="px-6 py-4">預測計畫實施中可能發生的問題，預先準備應變措施（風險預防）。</td><td class="px-6 py-4">對策實施</td></tr>
                            <tr class="hover:bg-gray-50"><td class="px-6 py-4 font-medium whitespace-nowrap">箭線圖法 (Arrow Diagram)</td><td class="px-6 py-4">規劃複雜工作的時程，找出關鍵路徑，控制進度。</td><td class="px-6 py-4">訂定活動計畫</td></tr>
                        </tbody>
                    </table>
                </div>

                <div class="mt-8 pt-4 border-t border-gray-200">
                    <h4 class="font-semibold text-lg text-gray-700 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        AI 輔助提問：想問點關於工具嗎？
                    </h4>
                    <div id="chat-qc-tools"></div>
                </div>
            </section>

        </main>

        <!-- 動態載入外部 HTML 的容器（書面格式 / 參考資料） -->
        <main id="page-dynamic" class="hidden mb-10">
            <div id="dynamic-content" class="bg-white p-6 sm:p-8 rounded-xl shadow-lg min-h-[50vh]">
                <!-- 這裡會用 fetch 塞入外部 HTML 的 <body> 內容 -->
            </div>
        </main>

        <!-- 頁尾（固定框架的一部分） -->
        <footer class="text-center py-6 mt-10 text-sm border-t border-gray-300 flex justify-between items-center">
            <p class="text-gray-500">品質改善是一段持續的旅程。祝您的品管圈活動順利成功！</p>
            <div class="text-right text-gray-700 font-medium">
                <p>奇美醫院 品質管理部 醫療品質科 製作</p>
                <p class="text-xs text-gray-500" id="last-updated">最後更新日期: 2025年12月01日</p>
            </div>
        </footer>

    </div>
    
    <!-- 快速回到頂端按鈕 -->
    <button id="backToTopBtn" 
            class="bg-teal-600 hover:bg-teal-700 text-white shadow-xl 
                   p-3 rounded-full flex items-center justify-center 
                   focus:outline-none focus:ring-4 focus:ring-teal-300 active:bg-teal-800 
                   transform hover:scale-105 transition duration-200"
            aria-label="快速回到頂端">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 10l7-7m0 0l7 7m-7-7v18" />
        </svg>
    </button>

    <script>
        // ========== 工具：切換 nav active ==========
        function setActive(buttonId) {
            document.querySelectorAll('.nav-button').forEach(btn => {
                btn.classList.remove('active');
            });
            const btn = document.getElementById(buttonId);
            if (btn) btn.classList.add('active');
        }

        // ========== 顯示 / 隱藏首頁與動態頁 ==========
        function showHomePage() {
            document.getElementById('page-home').classList.remove('hidden');
            document.getElementById('page-dynamic').classList.add('hidden');
        }

        function showDynamicPage() {
            document.getElementById('page-home').classList.add('hidden');
            document.getElementById('page-dynamic').classList.remove('hidden');
        }

        // ========== 首頁按鈕：回到完整首頁內容 ==========
        function goHome() {
            showHomePage();
            setActive('nav-btn-home');
            document.getElementById('header').scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }

        // ========== 使用 fetch 載入外部 HTML 並插入 dynamic-content ==========
        async function loadExternalPage(pageUrl, buttonId) {
            setActive(buttonId);
            showDynamicPage();

            const container = document.getElementById('dynamic-content');
            container.innerHTML = `
                <div class="flex items-center space-x-3 text-gray-600">
                    <div class="loading-spinner"></div>
                    <span>內容載入中，請稍候...</span>
                </div>
            `;

            try {
                const res = await fetch(pageUrl);
                if (!res.ok) {
                    throw new Error('HTTP status ' + res.status);
                }
                const htmlText = await res.text();

                // 解析 HTML，取得 <body> 內容（因你的外部檔是完整 HTML A 類型）
                const parser = new DOMParser();
                const doc = parser.parseFromString(htmlText, 'text/html');
                const body = doc.body;

                // 塞進容器（只拿 body 裡的東西）
                container.innerHTML = body ? body.innerHTML : htmlText;

                // 讓頁面捲到標題附近
                document.getElementById('header').scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });

                // 讓外部頁面的 <script> 能執行（如果有的話）
                const scripts = container.querySelectorAll('script');
                scripts.forEach(oldScript => {
                    const newScript = document.createElement('script');
                    if (oldScript.src) {
                        newScript.src = oldScript.src;
                    } else {
                        newScript.textContent = oldScript.textContent;
                    }
                    // 避免重複執行舊 script
                    oldScript.parentNode.replaceChild(newScript, oldScript);
                });

            } catch (e) {
                console.error('載入外部頁面失敗：', e);
                container.innerHTML = `
                    <p class="text-red-600">
                        抱歉，無法載入「${pageUrl}」。<br>
                        請確認檔案是否存在於 GitHub Pages 正確路徑，或稍後再試。
                    </p>
                `;
            }
        }

        // ========== AI 助理相關 ==========
        const API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent";
        const apiKey = ""; // 若未設定就不會真的呼叫 API

        async function fetchLLMResponse(contents, systemInstruction, maxRetries = 3) {
            if (!apiKey) {
                return '（目前尚未設定 API Key，因此無法連線到外部
